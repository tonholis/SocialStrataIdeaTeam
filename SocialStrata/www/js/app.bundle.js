!function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.buildings",["app.firebase"])}(),function(){"use strict";angular.module("app.firebase",[])}(),function(){"use strict";angular.module("app.profiles",[])}(),function(){"use strict";angular.module("app.sidemenu",[])}(),function(){"use strict";function e(e,n,i,t){e.data={},e.login=function(){n.login(e.data.username,e.data.password).success(function(e){t.go("app.buildings")}).error(function(e){i.alert({title:"Login failed!",template:"Please check your credentials!"})})}}e.$inject=["$scope","authService","$ionicPopup","$state"],angular.module("app.auth").controller("authController",e)}(),function(){"use strict";function e(e){return{login:function(n,i){var t=e.defer(),r=t.promise;return"user"==n&&"password"==i?t.resolve("Welcome "+n+"!"):t.reject("Wrong credentials!"),r.success=function(e){return r.then(e),r},r.error=function(e){return r.then(null,e),r},r},user:function(){return{username:"user",password:"password",type:Math.floor(2*Math.random())+1}}}}e.$inject=["$q"],angular.module("app.auth").service("authService",e)}(),function(){"use strict";function e(e){return{getChannelsFrom:function(n){return e.fb.database().ref("buildings/"+n+"/channels")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingChannelsService",e)}(),function(){"use strict";function e(e,n,i,t){var r=t.getChannelsFrom(i.buildingId);n.show(),r.on("value",function(i){var t=i.val();t&&(e.channels=angular.extend(t.common,t.services)),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred."});n.hide()})}e.$inject=["$scope","$ionicLoading","$stateParams","buildingChannelsService"],angular.module("app.buildings").controller("buildingController",e)}(),function(){"use strict";function e(e,n,i){var t=i.getBuildings();n.show(),t.on("value",function(i){e.buildings=i.val(),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred"});n.hide()})}e.$inject=["$scope","$ionicLoading","buildingsService"],angular.module("app.buildings").controller("buildingsController",e)}(),function(){"use strict";function e(e){return{getBuildings:function(){return e.fb.database().ref("buildings")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingsService",e)}(),function(){"use strict";function e(){var e={apiKey:"AIzaSyB5q81AGGox4i8-QL2KOtnDDfi05irgcHE",authDomain:"socialstrataideateam.firebaseapp.com",databaseURL:"https://socialstrataideateam.firebaseio.com",storageBucket:""};this.fb=firebase.initializeApp(e)}angular.module("app.firebase").service("firebaseService",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("app.profiles").controller("landlordProfileController",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("app.profiles").controller("tenantProfileController",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("app.sidemenu").controller("sidemenuController",e)}(),function(){"use strict";angular.module("app",["ionic","app.firebase","app.auth","app.sidemenu","app.buildings","app.profiles"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}])}(),function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("app",{url:"/app","abstract":!0,templateUrl:"views/sidemenu.html"}).state("app.buildings",{url:"/buildings",views:{menuContent:{templateUrl:"views/buildings.html"}}}).state("app.building",{url:"/buildings/:buildingId",views:{menuContent:{templateUrl:"views/building.html"}}}).state("app.profile",{url:"/profile",resolve:{user:["authService",function(e){return e.user()}]},views:{menuContent:{templateProvider:["$timeout","$stateParams","user",function(e,n,i){console.log(i);var t=null;return t=1==i.type?"views/profile/landlord.html":"views/profile/tenant.html",console.log(t),t}]}}}).state("login",{url:"/login",templateUrl:"views/auth/login.html"}),n.otherwise("/login")}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5tb2R1bGUuanMiLCJidWlsZGluZ3MvYnVpbGRpbmdzLm1vZHVsZS5qcyIsImZpcmViYXNlL2ZpcmViYXNlLm1vZHVsZS5qcyIsInByb2ZpbGUvcHJvZmlsZXMubW9kdWxlLmpzIiwic2lkZW1lbnUvc2lkZW1lbnUubW9kdWxlLmpzIiwiYXV0aC9hdXRoQ29udHJvbGxlci5qcyIsImFwcC5idW5kbGUuanMiLCJhdXRoL2F1dGhTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ29udHJvbGxlci5qcyIsImJ1aWxkaW5ncy9idWlsZGluZ3NDb250cm9sbGVyLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nc1NlcnZpY2UuanMiLCJmaXJlYmFzZS9maXJlYmFzZVNlcnZpY2UuanMiLCJwcm9maWxlL2xhbmRsb3JkUHJvZmlsZUNvbnRyb2xsZXIuanMiLCJwcm9maWxlL3RlbmFudFByb2ZpbGVDb250cm9sbGVyLmpzIiwic2lkZW1lbnUvc2lkZW1lbnVDb250cm9sbGVyLmpzIiwiYXBwLm1vZHVsZS5qcyIsImFwcC5yb3V0ZXIuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImF1dGhDb250cm9sbGVyIiwiJHNjb3BlIiwiYXV0aFNlcnZpY2UiLCIkaW9uaWNQb3B1cCIsIiRzdGF0ZSIsImRhdGEiLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJzdWNjZXNzIiwiZ28iLCJlcnJvciIsImFsZXJ0IiwidGl0bGUiLCJ0ZW1wbGF0ZSIsIiRpbmplY3QiLCJjb250cm9sbGVyIiwiJHEiLCJkZWZlcnJlZCIsImRlZmVyIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmbiIsInRoZW4iLCJ1c2VyIiwidHlwZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInNlcnZpY2UiLCJidWlsZGluZ0NoYW5uZWxzU2VydmljZSIsImZpcmViYXNlU2VydmljZSIsImdldENoYW5uZWxzRnJvbSIsImJ1aWxkaW5nIiwiZmIiLCJkYXRhYmFzZSIsInJlZiIsImJ1aWxkaW5nQ29udHJvbGxlciIsIiRpb25pY0xvYWRpbmciLCIkc3RhdGVQYXJhbXMiLCJidWlsZGluZ0lkIiwic2hvdyIsIm9uIiwic25hcHNob3QiLCJ2YWwiLCJjaGFubmVscyIsImV4dGVuZCIsImNvbW1vbiIsInNlcnZpY2VzIiwiaGlkZSIsImVycm9yT2JqZWN0IiwiY29uc29sZSIsImxvZyIsImNvZGUiLCJidWlsZGluZ3NDb250cm9sbGVyIiwiYnVpbGRpbmdzU2VydmljZSIsImdldEJ1aWxkaW5ncyIsImJ1aWxkaW5ncyIsImNvbmZpZyIsImFwaUtleSIsImF1dGhEb21haW4iLCJkYXRhYmFzZVVSTCIsInN0b3JhZ2VCdWNrZXQiLCJ0aGlzIiwiZmlyZWJhc2UiLCJpbml0aWFsaXplQXBwIiwibGFuZGxvcmRQcm9maWxlQ29udHJvbGxlciIsInRlbmFudFByb2ZpbGVDb250cm9sbGVyIiwic2lkZW1lbnVDb250cm9sbGVyIiwicnVuIiwiJGlvbmljUGxhdGZvcm0iLCJyZWFkeSIsIndpbmRvdyIsImNvcmRvdmEiLCJwbHVnaW5zIiwiS2V5Ym9hcmQiLCJoaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIiLCJkaXNhYmxlU2Nyb2xsIiwiU3RhdHVzQmFyIiwic3R5bGVEZWZhdWx0IiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsImFic3RyYWN0IiwidGVtcGxhdGVVcmwiLCJ2aWV3cyIsIm1lbnVDb250ZW50IiwidGVtcGxhdGVQcm92aWRlciIsIiR0aW1lb3V0IiwidmlldyIsIm90aGVyd2lzZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQUVBQSxTQUFBQyxPQUFBLGtCQ0hBLFdBQ0EsWUFFQUQsU0FBQUMsT0FBQSxpQkFBQSxvQkNIQSxXQUNBLFlBRUFELFNBQ0FDLE9BQUEsc0JDSkEsV0FDQSxZQUVBRCxTQUFBQyxPQUFBLHNCQ0hBLFdBQ0EsWUFF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LEdBQ0EyQixRQUFBQyxJQUFBNUIsRUFDQSxJQUFBa0UsR0FBQSxJQVVBLE9BUEFBLEdBREEsR0FBQWxFLEVBQUFDLEtBQ0EsOEJBRUEsNEJBR0EwQixRQUFBQyxJQUFBc0MsR0FFQUEsUUFNQVIsTUFBQSxTQUNBQyxJQUFBLFNBQ0FFLFlBQUEsMEJBSUFKLEVBQUFVLFVBQUEiLCJmaWxlIjoiYXBwLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIsIFsnYXBwLmZpcmViYXNlJ10pO1xufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnLCBbXSk7XG59KSgpO1xuXG5cblxuXG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5zaWRlbWVudVwiLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJhdXRoQ29udHJvbGxlclwiLCBhdXRoQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGF1dGhDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsICRpb25pY1BvcHVwLCAkc3RhdGUpIHtcblxuICAgICAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0YXV0aFNlcnZpY2UubG9naW4oJHNjb3BlLmRhdGEudXNlcm5hbWUsICRzY29wZS5kYXRhLnBhc3N3b3JkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5idWlsZGluZ3MnKTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbiBmYWlsZWQhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdQbGVhc2UgY2hlY2sgeW91ciBjcmVkZW50aWFscyEnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIsIFtdKTtcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiLCBbJ2FwcC5maXJlYmFzZSddKTtcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnLCBbXSk7XG59KSgpO1xuXG5cblxuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIiwgW10pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuc2lkZW1lbnVcIiwgW10pO1xufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhdXRoQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCIkaW9uaWNQb3B1cFwiLCBcIiRzdGF0ZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJhdXRoQ29udHJvbGxlclwiLCBhdXRoQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGF1dGhDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsICRpb25pY1BvcHVwLCAkc3RhdGUpIHtcblxuICAgICAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0YXV0aFNlcnZpY2UubG9naW4oJHNjb3BlLmRhdGEudXNlcm5hbWUsICRzY29wZS5kYXRhLnBhc3N3b3JkKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2FwcC5idWlsZGluZ3MnKTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbiBmYWlsZWQhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdQbGVhc2UgY2hlY2sgeW91ciBjcmVkZW50aWFscyEnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJhdXRoU2VydmljZVwiLCBhdXRoU2VydmljZSlcblxuXG4gICAgZnVuY3Rpb24gYXV0aFNlcnZpY2UoJHEpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbG9naW46IGZ1bmN0aW9uICh1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICAgICAgICAgIGlmICh1c2VybmFtZSA9PSAndXNlcicgJiYgcGFzc3dvcmQgPT0gJ3Bhc3N3b3JkJykge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdXZWxjb21lICcgKyB1c2VybmFtZSArICchJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCdXcm9uZyBjcmVkZW50aWFscyEnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcm9taXNlLmVycm9yID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihudWxsLCBmbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHVzZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogXCJ1c2VyXCIsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBcInBhc3N3b3JkXCIsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UnLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NoYW5uZWxzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Q2hhbm5lbHNGcm9tOiBmdW5jdGlvbiAoYnVpbGRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MvJyArIGJ1aWxkaW5nICsgXCIvY2hhbm5lbHNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYnVpbGRpbmdDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiYnVpbGRpbmdDaGFubmVsc1NlcnZpY2VcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJidWlsZGluZ0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdDb250cm9sbGVyKCRzY29wZSwgJGlvbmljTG9hZGluZywgJHN0YXRlUGFyYW1zLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSkge1xuXG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ0NoYW5uZWxzU2VydmljZS5nZXRDaGFubmVsc0Zyb20oJHN0YXRlUGFyYW1zLmJ1aWxkaW5nSWQpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSBzbmFwc2hvdC52YWwoKTtcblxuICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5jaGFubmVscyA9IGFuZ3VsYXIuZXh0ZW5kKHZhbC5jb21tb24sIHZhbC5zZXJ2aWNlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG5cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yT2JqZWN0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHJlYWRpbmc6IFwiICsgZXJyb3JPYmplY3QuY29kZSk7XG4gICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ09wcyEnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnU29ycnkhIEFuIGVycm9yIG9jdXJyZWQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBidWlsZGluZ3NDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiYnVpbGRpbmdzU2VydmljZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nc0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdzQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCBidWlsZGluZ3NTZXJ2aWNlKSB7XG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ3NTZXJ2aWNlLmdldEJ1aWxkaW5ncygpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgICRzY29wZS5idWlsZGluZ3MgPSBzbmFwc2hvdC52YWwoKTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGJ1aWxkaW5nc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdzU2VydmljZScsIGJ1aWxkaW5nc1NlcnZpY2UpO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0QnVpbGRpbmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcmViYXNlU2VydmljZS5mYi5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnKVxuICAgICAgICAuc2VydmljZSgnZmlyZWJhc2VTZXJ2aWNlJywgZmlyZWJhc2VTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gZmlyZWJhc2VTZXJ2aWNlKCkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5OiBcIkFJemFTeUI1cTgxQUdHb3g0aTgtUUwyS090bkREZmkwNWlyZ2NIRVwiLFxuICAgICAgICAgICAgYXV0aERvbWFpbjogXCJzb2NpYWxzdHJhdGFpZGVhdGVhbS5maXJlYmFzZWFwcC5jb21cIixcbiAgICAgICAgICAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vc29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2Vpby5jb21cIixcbiAgICAgICAgICAgIHN0b3JhZ2VCdWNrZXQ6IFwiXCIsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5mYiA9IGZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGxhbmRsb3JkUHJvZmlsZUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwibGFuZGxvcmRQcm9maWxlQ29udHJvbGxlclwiLCBsYW5kbG9yZFByb2ZpbGVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gbGFuZGxvcmRQcm9maWxlQ29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHRlbmFudFByb2ZpbGVDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInRlbmFudFByb2ZpbGVDb250cm9sbGVyXCIsIHRlbmFudFByb2ZpbGVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gdGVuYW50UHJvZmlsZUNvbnRyb2xsZXIoJHNjb3BlKSB7XG5cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBzaWRlbWVudUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5zaWRlbWVudVwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwic2lkZW1lbnVDb250cm9sbGVyXCIsIHNpZGVtZW51Q29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIHNpZGVtZW51Q29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnLCBbXG4gICAgICAgICAgICAnaW9uaWMnLFxuXHRcdFx0XG5cdFx0XHQnYXBwLmZpcmViYXNlJyxcbiAgICAgICAgICAgICdhcHAuYXV0aCcsXG4gICAgICAgICAgICAnYXBwLnNpZGVtZW51JyxcbiAgICAgICAgICAgICdhcHAuYnVpbGRpbmdzJyxcbiAgICAgICAgICAgICdhcHAucHJvZmlsZXMnXG4gICAgICAgIF0pXG5cbiAgICAgICAgLnJ1bihbXCIkaW9uaWNQbGF0Zm9ybVwiLCBmdW5jdGlvbiAoJGlvbmljUGxhdGZvcm0pIHtcbiAgICAgICAgICAgICRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmNvcmRvdmEgJiYgd2luZG93LmNvcmRvdmEucGx1Z2lucy5LZXlib2FyZCkge1xuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5kaXNhYmxlU2Nyb2xsKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAod2luZG93LlN0YXR1c0Jhcikge1xuICAgICAgICAgICAgICAgICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKTtcbn0pKCk7XG5cblxuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXJcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYXBwJyxcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3Mvc2lkZW1lbnUuaHRtbCcsXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLmJ1aWxkaW5ncycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2J1aWxkaW5ncycsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9idWlsZGluZ3MuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5idWlsZGluZycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2J1aWxkaW5ncy86YnVpbGRpbmdJZCcsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9idWlsZGluZy5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLnByb2ZpbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9wcm9maWxlJyxcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogW1wiYXV0aFNlcnZpY2VcIiwgZnVuY3Rpb24gKGF1dGhTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF1dGhTZXJ2aWNlLnVzZXIoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3ZpZGVyOiBbXCIkdGltZW91dFwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcInVzZXJcIiwgZnVuY3Rpb24gKCR0aW1lb3V0LCAkc3RhdGVQYXJhbXMsIHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci50eXBlID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSAndmlld3MvcHJvZmlsZS9sYW5kbG9yZC5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9ICd2aWV3cy9wcm9maWxlL3RlbmFudC5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codmlldyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2xvZ2luXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL2F1dGgvbG9naW4uaHRtbFwiXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vZmFsbGJhY2tcbiAgICAgICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy9sb2dpbicpO1xuXG4gICAgICAgIH1dKTtcbn0pKCk7XG5cblxuXG5cbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiKVxuXG4gICAgICAgIC5zZXJ2aWNlKFwiYXV0aFNlcnZpY2VcIiwgYXV0aFNlcnZpY2UpXG5cblxuICAgIGZ1bmN0aW9uIGF1dGhTZXJ2aWNlKCRxKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGxvZ2luOiBmdW5jdGlvbiAodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodXNlcm5hbWUgPT0gJ3VzZXInICYmIHBhc3N3b3JkID09ICdwYXNzd29yZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnV2VsY29tZSAnICsgdXNlcm5hbWUgKyAnIScpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgnV3JvbmcgY3JlZGVudGlhbHMhJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZm4pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5lcnJvciA9IGZ1bmN0aW9uIChmbikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4obnVsbCwgZm4pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICB1c2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IFwidXNlclwiLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogXCJwYXNzd29yZFwiLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSArIDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UnLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NoYW5uZWxzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Q2hhbm5lbHNGcm9tOiBmdW5jdGlvbiAoYnVpbGRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MvJyArIGJ1aWxkaW5nICsgXCIvY2hhbm5lbHNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwiYnVpbGRpbmdDb250cm9sbGVyXCIsIGJ1aWxkaW5nQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nQ29udHJvbGxlcigkc2NvcGUsICRpb25pY0xvYWRpbmcsICRzdGF0ZVBhcmFtcywgYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UpIHtcblxuICAgICAgICB2YXIgcmVmID0gYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UuZ2V0Q2hhbm5lbHNGcm9tKCRzdGF0ZVBhcmFtcy5idWlsZGluZ0lkKTtcblxuICAgICAgICAkaW9uaWNMb2FkaW5nLnNob3coKTtcbiAgICAgICAgcmVmLm9uKFwidmFsdWVcIiwgZnVuY3Rpb24gKHNuYXBzaG90KSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gc25hcHNob3QudmFsKCk7XG5cbiAgICAgICAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hhbm5lbHMgPSBhbmd1bGFyLmV4dGVuZCh2YWwuY29tbW9uLCB2YWwuc2VydmljZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvck9iamVjdCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciByZWFkaW5nOiBcIiArIGVycm9yT2JqZWN0LmNvZGUpO1xuICAgICAgICAgICAgdmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdPcHMhJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ1NvcnJ5ISBBbiBlcnJvciBvY3VycmVkLidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwiYnVpbGRpbmdzQ29udHJvbGxlclwiLCBidWlsZGluZ3NDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdzQ29udHJvbGxlcigkc2NvcGUsICRpb25pY0xvYWRpbmcsIGJ1aWxkaW5nc1NlcnZpY2UpIHtcbiAgICAgICAgdmFyIHJlZiA9IGJ1aWxkaW5nc1NlcnZpY2UuZ2V0QnVpbGRpbmdzKCk7XG5cbiAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG4gICAgICAgIHJlZi5vbihcInZhbHVlXCIsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgICAgICAgJHNjb3BlLmJ1aWxkaW5ncyA9IHNuYXBzaG90LnZhbCgpO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvck9iamVjdCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciByZWFkaW5nOiBcIiArIGVycm9yT2JqZWN0LmNvZGUpO1xuICAgICAgICAgICAgdmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdPcHMhJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ1NvcnJ5ISBBbiBlcnJvciBvY3VycmVkJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmJ1aWxkaW5ncycpXG4gICAgICAgIC5zZXJ2aWNlKCdidWlsZGluZ3NTZXJ2aWNlJywgYnVpbGRpbmdzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ3NTZXJ2aWNlKGZpcmViYXNlU2VydmljZSkge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRCdWlsZGluZ3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnKVxuICAgICAgICAuc2VydmljZSgnZmlyZWJhc2VTZXJ2aWNlJywgZmlyZWJhc2VTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gZmlyZWJhc2VTZXJ2aWNlKCkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5OiBcIkFJemFTeUI1cTgxQUdHb3g0aTgtUUwyS090bkREZmkwNWlyZ2NIRVwiLFxuICAgICAgICAgICAgYXV0aERvbWFpbjogXCJzb2NpYWxzdHJhdGFpZGVhdGVhbS5maXJlYmFzZWFwcC5jb21cIixcbiAgICAgICAgICAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vc29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2Vpby5jb21cIixcbiAgICAgICAgICAgIHN0b3JhZ2VCdWNrZXQ6IFwiXCIsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5mYiA9IGZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwibGFuZGxvcmRQcm9maWxlQ29udHJvbGxlclwiLCBsYW5kbG9yZFByb2ZpbGVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gbGFuZGxvcmRQcm9maWxlQ29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwidGVuYW50UHJvZmlsZUNvbnRyb2xsZXJcIiwgdGVuYW50UHJvZmlsZUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiB0ZW5hbnRQcm9maWxlQ29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5zaWRlbWVudVwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwic2lkZW1lbnVDb250cm9sbGVyXCIsIHNpZGVtZW51Q29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIHNpZGVtZW51Q29udHJvbGxlcigkc2NvcGUpIHtcblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJywgW1xuICAgICAgICAgICAgJ2lvbmljJyxcblx0XHRcdFxuXHRcdFx0J2FwcC5maXJlYmFzZScsXG4gICAgICAgICAgICAnYXBwLmF1dGgnLFxuICAgICAgICAgICAgJ2FwcC5zaWRlbWVudScsXG4gICAgICAgICAgICAnYXBwLmJ1aWxkaW5ncycsXG4gICAgICAgICAgICAnYXBwLnByb2ZpbGVzJ1xuICAgICAgICBdKVxuXG4gICAgICAgIC5ydW4oZnVuY3Rpb24gKCRpb25pY1BsYXRmb3JtKSB7XG4gICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuZGlzYWJsZVNjcm9sbCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5TdGF0dXNCYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgU3RhdHVzQmFyLnN0eWxlRGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbn0pKCk7XG5cblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJylcblxuICAgICAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwcCcsXG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3NpZGVtZW51Lmh0bWwnLFxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5idWlsZGluZ3MnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9idWlsZGluZ3MnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYnVpbGRpbmdzLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAuYnVpbGRpbmcnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9idWlsZGluZ3MvOmJ1aWxkaW5nSWQnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYnVpbGRpbmcuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5wcm9maWxlJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcHJvZmlsZScsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IGZ1bmN0aW9uIChhdXRoU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhdXRoU2VydmljZS51c2VyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3ZpZGVyOiBmdW5jdGlvbiAoJHRpbWVvdXQsICRzdGF0ZVBhcmFtcywgdXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1c2VyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZpZXcgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyLnR5cGUgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9ICd2aWV3cy9wcm9maWxlL2xhbmRsb3JkLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3ID0gJ3ZpZXdzL3Byb2ZpbGUvdGVuYW50Lmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh2aWV3KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmlldztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9sb2dpblwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9hdXRoL2xvZ2luLmh0bWxcIlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL2ZhbGxiYWNrXG4gICAgICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvbG9naW4nKTtcblxuICAgICAgICB9KTtcbn0pKCk7XG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
