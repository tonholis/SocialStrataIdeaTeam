!function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.buildings",["app.firebase"])}(),function(){"use strict";angular.module("app.firebase",[])}(),function(){"use strict";angular.module("app.message",[])}(),function(){"use strict";angular.module("app.profiles",["app.auth"])}(),function(){"use strict";angular.module("app.sidemenu",[])}(),function(){"use strict";angular.module("app.users",["app.auth"])}(),function(){"use strict";function e(e,n,t,i,a,r){e.data={},e.login=function(){i.show(),n.login(e.data.username,e.data.password).success(function(e){i.hide(),a.go("app.buildings")}).error(function(e){r(function(){i.hide()},100);t.alert({title:"Login failed!",template:e.message})})},e.facebookLogin=function(){t.alert({title:"Facebook login",template:"Planned!"})}}e.$inject=["$scope","authService","$ionicPopup","$ionicLoading","$state","$timeout"],angular.module("app.auth").controller("authController",e)}(),function(){"use strict";function e(e,n,t,i){var a=t.fb.auth();return n.$on("name-changed",function(){var e=firebase.auth().currentUser;null!=e&&firebase.database().ref("users/"+e.uid).set({name:e.displayName,email:e.email,lastActivity:(new Date).getTime()})}),{login:function(t,r){var u=e.defer(),o=u.promise,s=function(e){e.isNew=null==e.displayName,u.resolve(e),i=firebase.auth().currentUser,n.$broadcast("name-changed")},l=function(e){u.reject(e)};return a.signInWithEmailAndPassword(t,r).then(s,function c(c){"auth/user-not-found"==c.code?a.createUserWithEmailAndPassword(t,r).then(s,l):l(c)}),o.success=function(e){return o.then(e),o},o.error=function(e){return o.then(null,e),o},o},logout:function(){a.signOut(),i=firebase.auth().currentUser},user:function(){return firebase.auth().currentUser}}}e.$inject=["$q","$rootScope","firebaseService","user"],angular.module("app.auth").service("authService",e)}(),function(){"use strict";function e(e){return{getChannelsFrom:function(n){return e.fb.database().ref("buildings/"+n+"/channels")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingChannelsService",e)}(),function(){"use strict";function e(e,n,t,i){var a=i.getChannelsFrom(t.buildingId);n.show(),a.on("value",function(t){var i=t.val();i&&(e.channels=angular.extend(i.common,i.services)),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred."});n.hide()})}e.$inject=["$scope","$ionicLoading","$stateParams","buildingChannelsService"],angular.module("app.buildings").controller("buildingController",e)}(),function(){"use strict";function e(e,n,t){var i=t.getBuildings();n.show(),i.on("value",function(t){e.buildings=t.val(),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred"});n.hide()})}e.$inject=["$scope","$ionicLoading","buildingsService"],angular.module("app.buildings").controller("buildingsController",e)}(),function(){"use strict";function e(e){return{getBuildings:function(){return e.fb.database().ref("buildings")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingsService",e)}(),function(){"use strict";function e(){var e={apiKey:"AIzaSyB5q81AGGox4i8-QL2KOtnDDfi05irgcHE",authDomain:"socialstrataideateam.firebaseapp.com",databaseURL:"https://socialstrataideateam.firebaseio.com",storageBucket:""};this.fb=firebase.initializeApp(e)}angular.module("app.firebase").service("firebaseService",e)}(),function(){"use strict";angular.module("app.message")}(),function(){"use strict";function e(){var e={};return e.getMessagesRef=function(){return firebase.database().ref("messages")},e}angular.module("app.message").service("messagesService",e)}(),function(){"use strict";function e(e,n,t,i,a){var r=i.user();e.data={displayName:r?r.displayName:"",email:r?r.email:""},e.update=function(){n.show(),a.updateProfile(e.data).then(function(e){n.hide(),t.alert({title:"ProfileUpdate!",template:e})},function i(i){n.hide(),t.alert({title:"Update failed!",template:i.message})})}}e.$inject=["$scope","$ionicLoading","$ionicPopup","authService","profilesService"],angular.module("app.profiles").controller("profileController",e)}(),function(){"use strict";function e(e,n,t,i){return{updateProfile:function(a){var r=e.defer();return t.user().updateProfile(a).then(function(){r.resolve("Profile updated!"),i=firebase.auth().currentUser,n.$broadcast("name-changed")},function u(u){r.reject(u)}),r.promise}}}e.$inject=["$q","$rootScope","authService","user"],angular.module("app.profiles").service("profilesService",e)}(),function(){"use strict";function e(e,n,t){e.$on("name-changed",function(){e.displayName=n.user().displayName});var i=n.user();e.displayName=i?i.displayName:"Edit Name"}e.$inject=["$scope","authService","messagesService"],angular.module("app.sidemenu").controller("sidemenuController",e)}(),function(){"use strict";function e(e,n){return{updateProfile:function(t){var i=e.defer();return n.user().updateProfile(t).then(function(){i.resolve("Profile updated!"),user=firebase.auth().currentUser,$rootScope.$broadcast("name-changed")},function a(a){i.reject(a)}),i.promise}}}e.$inject=["$q","authService"],angular.module("app.users").service("usersService",e)}(),function(){"use strict";angular.module("app",["ionic","app.firebase","app.auth","app.message","app.sidemenu","app.buildings","app.profiles"]).value("user",null).run(["$ionicPlatform","$timeout","$rootScope",function(e,n,t){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),t.$broadcast("name-changed")})}])}(),function(){"use strict";angular.module("app").run(["$rootScope","$location","authService",function(e,n,t){e.$on("$routeChangeStart",function(e){null==t.user()&&(e.preventDefault(),n.go("login"))})}])}(),function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("app",{url:"/app",cache:!1,"abstract":!0,templateUrl:"views/sidemenu.html"}).state("app.buildings",{url:"/buildings",views:{menuContent:{templateUrl:"views/buildings.html"}}}).state("app.building",{url:"/buildings/:buildingId",views:{menuContent:{templateUrl:"views/building.html"}}}).state("app.profile",{url:"/profile",cache:!1,views:{menuContent:{templateUrl:"views/profile/profile.html"}}}).state("app.logout",{url:"/login",templateProvider:["authService","$state",function(e,n){e.logout(),n.go("login")}]}).state("login",{url:"/login",templateUrl:"views/auth/login.html"}),n.otherwise("/login")}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5tb2R1bGUuanMiLCJidWlsZGluZ3MvYnVpbGRpbmdzLm1vZHVsZS5qcyIsImZpcmViYXNlL2ZpcmViYXNlLm1vZHVsZS5qcyIsIm1lc3NhZ2VzL21lc3NhZ2VzLm1vZHVsZS5qcyIsInByb2ZpbGUvcHJvZmlsZXMubW9kdWxlLmpzIiwic2lkZW1lbnUvc2lkZW1lbnUubW9kdWxlLmpzIiwidXNlcnMvdXNlcnMubW9kdWxlLmpzIiwiYXV0aC9hdXRoQ29udHJvbGxlci5qcyIsImFwcC5idW5kbGUuanMiLCJhdXRoL2F1dGhTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ29udHJvbGxlci5qcyIsImJ1aWxkaW5ncy9idWlsZGluZ3NDb250cm9sbGVyLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nc1NlcnZpY2UuanMiLCJmaXJlYmFzZS9maXJlYmFzZVNlcnZpY2UuanMiLCJtZXNzYWdlcy9tZXNzYWdlc0NvbnRyb2xsZXIuanMiLCJtZXNzYWdlcy9tZXNzYWdlc1NlcnZpY2UuanMiLCJwcm9maWxlL3Byb2ZpbGVDb250cm9sbGVyLmpzIiwicHJvZmlsZS9wcm9maWxlc1NlcnZpY2UuanMiLCJzaWRlbWVudS9zaWRlbWVudUNvbnRyb2xsZXIuanMiLCJ1c2Vycy91c2Vyc1NlcnZpY2UuanMiLCJhcHAubW9kdWxlLmpzIiwiYXBwLnJvdXRlci5maWx0ZXIuanMiLCJhcHAucm91dGVyLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJhdXRoQ29udHJvbGxlciIsIiRzY29wZSIsImF1dGhTZXJ2aWNlIiwiJGlvbmljUG9wdXAiLCIkaW9uaWNMb2FkaW5nIiwiJHN0YXRlIiwiJHRpbWVvdXQiLCJkYXRhIiwibG9naW4iLCJzaG93IiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInN1Y2Nlc3MiLCJ1c2VyIiwiaGlkZSIsImdvIiwiZXJyb3IiLCJhbGVydCIsInRpdGxlIiwidGVtcGxhdGUiLCJtZXNzYWdlIiwiZmFjZWJvb2tMb2dpbiIsIiRpbmplY3QiLCJjb250cm9sbGVyIiwiJHEiLCIkcm9vdFNjb3BlIiwiZmlyZWJhc2VTZXJ2aWNlIiwiYXV0aCIsImZiIiwiJG9uIiwidXNyIiwiZmlyZWJhc2UiLCJjdXJyZW50VXNlciIsImRhdGFiYXNlIiwicmVmIiwidWlkIiwic2V0IiwibmFtZSIsImRpc3BsYXlOYW1lIiwiZW1haWwiLCJsYXN0QWN0aXZpdHkiLCJEYXRlIiwiZ2V0VGltZSIsImRlZmVycmVkIiwiZGVmZXIiLCJwcm9taXNlIiwic3VjY2Vzc0hhbmRsZXIiLCJpbmZvIiwiaXNOZXciLCJyZXNvbHZlIiwiJGJyb2FkY2FzdCIsImVycm9ySGFuZGxlciIsInJlamVjdCIsInNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkIiwidGhlbiIsImNvZGUiLCJjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQiLCJmbiIsImxvZ291dCIsInNpZ25PdXQiLCJzZXJ2aWNlIiwiYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UiLCJnZXRDaGFubmVsc0Zyb20iLCJidWlsZGluZyIsImJ1aWxkaW5nQ29udHJvbGxlciIsIiRzdGF0ZVBhcmFtcyIsImJ1aWxkaW5nSWQiLCJvbiIsInNuYXBzaG90IiwidmFsIiwiY2hhbm5lbHMiLCJleHRlbmQiLCJjb21tb24iLCJzZXJ2aWNlcyIsImVycm9yT2JqZWN0IiwiY29uc29sZSIsImxvZyIsImJ1aWxkaW5nc0NvbnRyb2xsZXIiLCJidWlsZGluZ3NTZXJ2aWNlIiwiZ2V0QnVpbGRpbmdzIiwiYnVpbGRpbmdzIiwiY29uZmlnIiwiYXBpS2V5IiwiYXV0aERvbWFpbiIsImRhdGFiYXNlVVJMIiwic3RvcmFnZUJ1Y2tldCIsInRoaXMiLCJpbml0aWFsaXplQXBwIiwibWVzc2FnZXNTZXJ2aWNlIiwib2JqIiwiZ2V0TWVzc2FnZXNSZWYiLCJwcm9maWxlQ29udHJvbGxlciIsInByb2ZpbGVzU2VydmljZSIsInVwZGF0ZSIsInVwZGF0ZVByb2ZpbGUiLCJtc2ciLCJzaWRlbWVudUNvbnRyb2xsZXIiLCJ1c2Vyc1NlcnZpY2UiLCJ2YWx1ZSIsInJ1biIsIiRpb25pY1BsYXRmb3JtIiwicmVhZHkiLCJ3aW5kb3ciLCJjb3Jkb3ZhIiwicGx1Z2lucyIsIktleWJvYXJkIiwiaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyIiwiZGlzYWJsZVNjcm9sbCIsIlN0YXR1c0JhciIsInN0eWxlRGVmYXVsdCIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsInN0YXRlIiwidXJsIiwiY2FjaGUiLCJhYnN0cmFjdCIsInRlbXBsYXRlVXJsIiwidmlld3MiLCJtZW51Q29udGVudCIsInRlbXBsYXRlUHJvdmlkZXIiLCJvdGhlcndpc2UiXSwibWFwcGluZ3MiOiJDQUFBLFdBQ0EsWUFFQUEsU0FBQUMsT0FBQSxrQkNIQSxXQUNBLFlBRUFELFNBQUFDLE9BQUEsaUJBQUEsb0JDSEEsV0FDQSxZQUVBRCxTQUNBQyxPQUFBLHNCQ0pBLFdBQ0EsWUFFQUQsU0FDQUMsT0FBQSxxQkNKQSxXQUNBLFlBRUFELFNBQUFDLE9BQUEsZ0JBQUEsZ0JDSEEsV0FDQSxZQUVBRCxTQUFBQyxPQUFBLHNCQ0hBLFdBQ0EsWUFFQUQsU0FBQUMsT0FBQSxhQUFBLGdCQ0hBLFdBQ0EsWUFPQSxTQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBTCxFQUFBTSxRQUVBTixFQUFBTyxNQUFBLFdBQ0FKLEVBQUFLLE9BRUFQLEVBQUFNLE1BQUFQLEVBQUFNLEtBQUFHLFNBQUFULEVBQUFNLEtBQUFJLFVBQUFDLFFBQUEsU0FBQUMsR0FDQVQsRUFBQVUsT0FDQVQsRUFBQVUsR0FBQSxtQkFFQUMsTUFBQSxTQUFBQSxHQUNBVixFQUFBLFdBQ0FGLEVBQUFVLFFBQ0EsSUFFQVgsR0FBQWMsT0FDQUMsTUFBQSxnQkFDQUMsU0FBQUgsRUFBQUksYUFLQW5CLEVBQUFvQixjQUFBLFdBQ0FsQixFQUFB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cHAuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIiwgWydhcHAuZmlyZWJhc2UnXSk7XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5maXJlYmFzZScsIFtdKTtcbn0pKCk7XG5cblxuXG5cbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAubWVzc2FnZScsIFtdKTtcbn0pKCk7XG5cblxuXG5cbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIiwgWydhcHAuYXV0aCddKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5zaWRlbWVudVwiLCBbXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAudXNlcnNcIiwgWydhcHAuYXV0aCddKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmF1dGhcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImF1dGhDb250cm9sbGVyXCIsIGF1dGhDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYXV0aENvbnRyb2xsZXIoJHNjb3BlLCBhdXRoU2VydmljZSwgJGlvbmljUG9wdXAsICRpb25pY0xvYWRpbmcsICRzdGF0ZSwgJHRpbWVvdXQpIHtcblxuICAgICAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0JGlvbmljTG9hZGluZy5zaG93KCk7XG5cblx0XHRcdGF1dGhTZXJ2aWNlLmxvZ2luKCRzY29wZS5kYXRhLnVzZXJuYW1lLCAkc2NvcGUuZGF0YS5wYXNzd29yZCkuc3VjY2VzcyhmdW5jdGlvbih1c2VyKSB7XG5cdFx0XHRcdCRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXHRcdFx0XHQkc3RhdGUuZ28oJ2FwcC5idWlsZGluZ3MnKTtcblxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdFx0JHRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cdFx0XHRcdH0sIDEwMCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbiBmYWlsZWQhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IGVycm9yLm1lc3NhZ2UgLy8nUGxlYXNlIGNoZWNrIHlvdXIgY3JlZGVudGlhbHMhJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXHRcdCRzY29wZS5mYWNlYm9va0xvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcblx0XHRcdFx0dGl0bGU6ICdGYWNlYm9vayBsb2dpbicsXG5cdFx0XHRcdHRlbXBsYXRlOiAnUGxhbm5lZCEnXG5cdFx0XHR9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIsIFtdKTtcbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiLCBbJ2FwcC5maXJlYmFzZSddKTtcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnLCBbXSk7XG59KSgpO1xuXG5cblxuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAubWVzc2FnZScsIFtdKTtcbn0pKCk7XG5cblxuXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiLCBbJ2FwcC5hdXRoJ10pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuc2lkZW1lbnVcIiwgW10pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAudXNlcnNcIiwgWydhcHAuYXV0aCddKTtcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYXV0aENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcImF1dGhTZXJ2aWNlXCIsIFwiJGlvbmljUG9wdXBcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiJHN0YXRlXCIsIFwiJHRpbWVvdXRcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwiYXV0aENvbnRyb2xsZXJcIiwgYXV0aENvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBhdXRoQ29udHJvbGxlcigkc2NvcGUsIGF1dGhTZXJ2aWNlLCAkaW9uaWNQb3B1cCwgJGlvbmljTG9hZGluZywgJHN0YXRlLCAkdGltZW91dCkge1xuXG4gICAgICAgICRzY29wZS5kYXRhID0ge307XG5cbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0XHQkaW9uaWNMb2FkaW5nLnNob3coKTtcblxuXHRcdFx0YXV0aFNlcnZpY2UubG9naW4oJHNjb3BlLmRhdGEudXNlcm5hbWUsICRzY29wZS5kYXRhLnBhc3N3b3JkKS5zdWNjZXNzKGZ1bmN0aW9uKHVzZXIpIHtcblx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cdFx0XHRcdCRzdGF0ZS5nbygnYXBwLmJ1aWxkaW5ncycpO1xuXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0XHQkdGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblx0XHRcdFx0fSwgMTAwKTtcblxuICAgICAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0xvZ2luIGZhaWxlZCEnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZXJyb3IubWVzc2FnZSAvLydQbGVhc2UgY2hlY2sgeW91ciBjcmVkZW50aWFscyEnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG5cdFx0JHNjb3BlLmZhY2Vib29rTG9naW4gPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuXHRcdFx0XHR0aXRsZTogJ0ZhY2Vib29rIGxvZ2luJyxcblx0XHRcdFx0dGVtcGxhdGU6ICdQbGFubmVkISdcblx0XHRcdH0pO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhdXRoU2VydmljZS4kaW5qZWN0ID0gW1wiJHFcIiwgXCIkcm9vdFNjb3BlXCIsIFwiZmlyZWJhc2VTZXJ2aWNlXCIsIFwidXNlclwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJhdXRoU2VydmljZVwiLCBhdXRoU2VydmljZSk7XG5cblx0ZnVuY3Rpb24gY3JlYXRlVXNlcih1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXHRcdHZhciBhdXRoID0gZmlyZWJhc2VTZXJ2aWNlLmZiLmF1dGgoKTtcblxuXHRcdHJldHVybiBhdXRoLmNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZChlbWFpbCwgcGFzc3dvcmQpO1xuXHR9XG5cdFxuICAgIGZ1bmN0aW9uIGF1dGhTZXJ2aWNlKCRxLCAkcm9vdFNjb3BlLCBmaXJlYmFzZVNlcnZpY2UsIHVzZXIpIHtcblx0XHR2YXIgYXV0aCA9IGZpcmViYXNlU2VydmljZS5mYi5hdXRoKCk7XG5cdFx0XG5cdFx0JHJvb3RTY29wZS4kb24oJ25hbWUtY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHVzciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcblx0XHRcdGlmICh1c3IgPT0gbnVsbCkgcmV0dXJuO1xuXHRcdFx0XG5cdFx0XHRmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZigndXNlcnMvJyArIHVzci51aWQpLnNldCh7XG5cdFx0XHRcdG5hbWU6IHVzci5kaXNwbGF5TmFtZSxcblx0XHRcdFx0ZW1haWw6IHVzci5lbWFpbCxcblx0XHRcdFx0bGFzdEFjdGl2aXR5OiBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuXHRcdFx0fSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4ge1xuICAgICAgICAgICAgbG9naW46IGZ1bmN0aW9uKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBkZWZlcnJlZC5wcm9taXNlO1xuXG5cdFx0XHRcdHZhciBzdWNjZXNzSGFuZGxlciA9IGZ1bmN0aW9uKGluZm8pIHtcblx0XHRcdFx0XHRpbmZvLmlzTmV3ID0gaW5mby5kaXNwbGF5TmFtZSA9PSBudWxsO1xuXHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoaW5mbyk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHR1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuXHRcdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmFtZS1jaGFuZ2VkJyk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0dmFyIGVycm9ySGFuZGxlciA9IGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRhdXRoLnNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0XHQudGhlbihzdWNjZXNzSGFuZGxlciwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcblx0XHRcdFx0XHRcdGlmIChlcnJvci5jb2RlID09IFwiYXV0aC91c2VyLW5vdC1mb3VuZFwiKSB7XG5cdFx0XHRcdFx0XHRcdGF1dGguY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0XHRcdFx0XHQudGhlbihzdWNjZXNzSGFuZGxlciwgZXJyb3JIYW5kbGVyKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlcnJvckhhbmRsZXIoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzID0gZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS50aGVuKGZuKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb21pc2UuZXJyb3IgPSBmdW5jdGlvbihmbikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4obnVsbCwgZm4pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG5cdFx0XHRsb2dvdXQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0YXV0aC5zaWduT3V0KCk7XG5cdFx0XHRcdHVzZXIgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7XG5cdFx0XHR9LFxuXG4gICAgICAgICAgICB1c2VyOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UnLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NoYW5uZWxzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Q2hhbm5lbHNGcm9tOiBmdW5jdGlvbiAoYnVpbGRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MvJyArIGJ1aWxkaW5nICsgXCIvY2hhbm5lbHNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYnVpbGRpbmdDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiYnVpbGRpbmdDaGFubmVsc1NlcnZpY2VcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJidWlsZGluZ0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdDb250cm9sbGVyKCRzY29wZSwgJGlvbmljTG9hZGluZywgJHN0YXRlUGFyYW1zLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSkge1xuXG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ0NoYW5uZWxzU2VydmljZS5nZXRDaGFubmVsc0Zyb20oJHN0YXRlUGFyYW1zLmJ1aWxkaW5nSWQpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSBzbmFwc2hvdC52YWwoKTtcblxuICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5jaGFubmVscyA9IGFuZ3VsYXIuZXh0ZW5kKHZhbC5jb21tb24sIHZhbC5zZXJ2aWNlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG5cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yT2JqZWN0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHJlYWRpbmc6IFwiICsgZXJyb3JPYmplY3QuY29kZSk7XG4gICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ09wcyEnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnU29ycnkhIEFuIGVycm9yIG9jdXJyZWQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBidWlsZGluZ3NDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiYnVpbGRpbmdzU2VydmljZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nc0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdzQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCBidWlsZGluZ3NTZXJ2aWNlKSB7XG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ3NTZXJ2aWNlLmdldEJ1aWxkaW5ncygpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgICRzY29wZS5idWlsZGluZ3MgPSBzbmFwc2hvdC52YWwoKTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGJ1aWxkaW5nc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdzU2VydmljZScsIGJ1aWxkaW5nc1NlcnZpY2UpO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0QnVpbGRpbmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcmViYXNlU2VydmljZS5mYi5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnKVxuICAgICAgICAuc2VydmljZSgnZmlyZWJhc2VTZXJ2aWNlJywgZmlyZWJhc2VTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gZmlyZWJhc2VTZXJ2aWNlKCkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5OiBcIkFJemFTeUI1cTgxQUdHb3g0aTgtUUwyS090bkREZmkwNWlyZ2NIRVwiLFxuICAgICAgICAgICAgYXV0aERvbWFpbjogXCJzb2NpYWxzdHJhdGFpZGVhdGVhbS5maXJlYmFzZWFwcC5jb21cIixcbiAgICAgICAgICAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vc29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2Vpby5jb21cIixcbiAgICAgICAgICAgIHN0b3JhZ2VCdWNrZXQ6IFwiXCIsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5mYiA9IGZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLm1lc3NhZ2UnKTtcbn0pKCk7XG5cblxuXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5tZXNzYWdlJylcbiAgICAgICAgLnNlcnZpY2UoJ21lc3NhZ2VzU2VydmljZScsIG1lc3NhZ2VzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBtZXNzYWdlc1NlcnZpY2UoKSB7XG5cdFx0dmFyIG9iaiA9IHt9O1xuXHRcdFxuXHRcdG9iai5nZXRNZXNzYWdlc1JlZiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignbWVzc2FnZXMnKTtcblx0XHR9O1xuXHRcdFxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBwcm9maWxlQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGlvbmljTG9hZGluZ1wiLCBcIiRpb25pY1BvcHVwXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCJwcm9maWxlc1NlcnZpY2VcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInByb2ZpbGVDb250cm9sbGVyXCIsIHByb2ZpbGVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvZmlsZUNvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCAkaW9uaWNQb3B1cCwgYXV0aFNlcnZpY2UsIHByb2ZpbGVzU2VydmljZSkge1xuXG5cdFx0dmFyIHVzZXIgPSBhdXRoU2VydmljZS51c2VyKCk7XG5cdFx0XG5cdFx0JHNjb3BlLmRhdGEgPSB7XG5cdFx0XHRkaXNwbGF5TmFtZSA6IHVzZXIgPyB1c2VyLmRpc3BsYXlOYW1lIDogXCJcIixcblx0XHRcdGVtYWlsIDogdXNlciA/IHVzZXIuZW1haWwgOiBcIlwiXG5cdFx0fTtcblxuICAgICAgICAkc2NvcGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHQkaW9uaWNMb2FkaW5nLnNob3coKTtcblxuICAgICAgICAgICAgcHJvZmlsZXNTZXJ2aWNlLnVwZGF0ZVByb2ZpbGUoJHNjb3BlLmRhdGEpLnRoZW4oZnVuY3Rpb24gc3VjY2Vzcyhtc2cpIHtcblx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cblx0XHRcdFx0JGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Byb2ZpbGVVcGRhdGUhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IG1zZ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xuXHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblxuXHRcdFx0XHQkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXBkYXRlIGZhaWxlZCEnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHByb2ZpbGVzU2VydmljZS4kaW5qZWN0ID0gW1wiJHFcIiwgXCIkcm9vdFNjb3BlXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCJ1c2VyXCJdO1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJwcm9maWxlc1NlcnZpY2VcIiwgcHJvZmlsZXNTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvZmlsZXNTZXJ2aWNlKCRxLCAkcm9vdFNjb3BlLCBhdXRoU2VydmljZSwgdXNlcikge1xuXHRcdFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlUHJvZmlsZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS51c2VyKCkudXBkYXRlUHJvZmlsZShkYXRhKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShcIlByb2ZpbGUgdXBkYXRlZCFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBzaWRlbWVudUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcImF1dGhTZXJ2aWNlXCIsIFwibWVzc2FnZXNTZXJ2aWNlXCJdO1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnNpZGVtZW51XCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJzaWRlbWVudUNvbnRyb2xsZXJcIiwgc2lkZW1lbnVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gc2lkZW1lbnVDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsIG1lc3NhZ2VzU2VydmljZSkge1xuXHRcdCRzY29wZS4kb24oJ25hbWUtY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0JHNjb3BlLmRpc3BsYXlOYW1lID0gYXV0aFNlcnZpY2UudXNlcigpLmRpc3BsYXlOYW1lO1xuXHRcdH0pO1xuXHRcdFxuXHRcdHZhciB1c2VyID0gYXV0aFNlcnZpY2UudXNlcigpO1xuXHRcdCRzY29wZS5kaXNwbGF5TmFtZSA9IHVzZXIgPyB1c2VyLmRpc3BsYXlOYW1lIDogXCJFZGl0IE5hbWVcIjtcbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdXNlcnNTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcVwiLCBcImF1dGhTZXJ2aWNlXCJdO1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnVzZXJzXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJ1c2Vyc1NlcnZpY2VcIiwgdXNlcnNTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gdXNlcnNTZXJ2aWNlKCRxLCBhdXRoU2VydmljZSkge1xuXHQgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVwZGF0ZVByb2ZpbGU6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UudXNlcigpLnVwZGF0ZVByb2ZpbGUoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gc3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoXCJQcm9maWxlIHVwZGF0ZWQhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmFtZS1jaGFuZ2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnLCBbXG4gICAgICAgICAgICAnaW9uaWMnLFxuXHRcdFx0XG5cdFx0XHQnYXBwLmZpcmViYXNlJyxcbiAgICAgICAgICAgICdhcHAuYXV0aCcsXG4gICAgICAgICAgICAnYXBwLm1lc3NhZ2UnLFxuXHRcdFx0J2FwcC5zaWRlbWVudScsXG4gICAgICAgICAgICAnYXBwLmJ1aWxkaW5ncycsXG4gICAgICAgICAgICAnYXBwLnByb2ZpbGVzJ1xuICAgICAgICBdKVxuXHRcdFxuXHRcdC52YWx1ZShcInVzZXJcIiwgbnVsbClcblxuICAgICAgICAucnVuKFtcIiRpb25pY1BsYXRmb3JtXCIsIFwiJHRpbWVvdXRcIiwgXCIkcm9vdFNjb3BlXCIsIGZ1bmN0aW9uICgkaW9uaWNQbGF0Zm9ybSwgJHRpbWVvdXQsICRyb290U2NvcGUpIHtcblx0XHRcdCRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmNvcmRvdmEgJiYgd2luZG93LmNvcmRvdmEucGx1Z2lucy5LZXlib2FyZCkge1xuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5kaXNhYmxlU2Nyb2xsKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAod2luZG93LlN0YXR1c0Jhcikge1xuICAgICAgICAgICAgICAgICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuXHRcdFx0XHRcblx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSk7XG59KSgpO1xuXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJylcblxuICAgICAgICAucnVuKFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnYXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHN0YXRlLCBhdXRoU2VydmljZSkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UudXNlcigpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG5cdFx0XG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgZnVuY3Rpb24gKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuICAgICAgICAgICAgJHN0YXRlUHJvdmlkZXJcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYXBwJyxcblx0XHRcdFx0XHRjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3NpZGVtZW51Lmh0bWwnLFxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5idWlsZGluZ3MnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9idWlsZGluZ3MnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYnVpbGRpbmdzLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAuYnVpbGRpbmcnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9idWlsZGluZ3MvOmJ1aWxkaW5nSWQnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYnVpbGRpbmcuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5wcm9maWxlJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcHJvZmlsZScsXG5cdFx0XHRcdFx0Y2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuXHRcdFx0XHRcdFx0XHR0ZW1wbGF0ZVVybDogJ3ZpZXdzL3Byb2ZpbGUvcHJvZmlsZS5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuXHRcdFx0XHQuc3RhdGUoJ2FwcC5sb2dvdXQnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvbG9naW5cIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVQcm92aWRlcjogW1wiYXV0aFNlcnZpY2VcIiwgXCIkc3RhdGVcIiwgZnVuY3Rpb24gKGF1dGhTZXJ2aWNlLCAkc3RhdGUpIHtcblx0XHRcdFx0XHRcdGF1dGhTZXJ2aWNlLmxvZ291dCgpO1xuXHRcdFx0XHRcdFx0JHN0YXRlLmdvKCdsb2dpbicpO1xuXHRcdFx0XHRcdH1dXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2xvZ2luXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL2F1dGgvbG9naW4uaHRtbFwiXG4gICAgICAgICAgICAgICAgfSk7XG5cdFx0XHRcdFxuXG4gICAgICAgICAgICAvL2ZhbGxiYWNrXG4gICAgICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvbG9naW4nKTtcblxuICAgICAgICB9XSk7XG59KSgpO1xuXG5cblxuXG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiKVxuXG4gICAgICAgIC5zZXJ2aWNlKFwiYXV0aFNlcnZpY2VcIiwgYXV0aFNlcnZpY2UpO1xuXG5cdGZ1bmN0aW9uIGNyZWF0ZVVzZXIodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblx0XHR2YXIgYXV0aCA9IGZpcmViYXNlU2VydmljZS5mYi5hdXRoKCk7XG5cblx0XHRyZXR1cm4gYXV0aC5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKTtcblx0fVxuXHRcbiAgICBmdW5jdGlvbiBhdXRoU2VydmljZSgkcSwgJHJvb3RTY29wZSwgZmlyZWJhc2VTZXJ2aWNlLCB1c2VyKSB7XG5cdFx0dmFyIGF1dGggPSBmaXJlYmFzZVNlcnZpY2UuZmIuYXV0aCgpO1xuXHRcdFxuXHRcdCRyb290U2NvcGUuJG9uKCduYW1lLWNoYW5nZWQnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB1c3IgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7XG5cdFx0XHRpZiAodXNyID09IG51bGwpIHJldHVybjtcblx0XHRcdFxuXHRcdFx0ZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYoJ3VzZXJzLycgKyB1c3IudWlkKS5zZXQoe1xuXHRcdFx0XHRuYW1lOiB1c3IuZGlzcGxheU5hbWUsXG5cdFx0XHRcdGVtYWlsOiB1c3IuZW1haWwsXG5cdFx0XHRcdGxhc3RBY3Rpdml0eTogbmV3IERhdGUoKS5nZXRUaW1lKClcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHtcbiAgICAgICAgICAgIGxvZ2luOiBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcblxuXHRcdFx0XHR2YXIgc3VjY2Vzc0hhbmRsZXIgPSBmdW5jdGlvbihpbmZvKSB7XG5cdFx0XHRcdFx0aW5mby5pc05ldyA9IGluZm8uZGlzcGxheU5hbWUgPT0gbnVsbDtcblx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGluZm8pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0dXNlciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ25hbWUtY2hhbmdlZCcpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHZhciBlcnJvckhhbmRsZXIgPSBmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdChlcnJvcik7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0YXV0aC5zaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCh1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0LnRoZW4oc3VjY2Vzc0hhbmRsZXIsIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRpZiAoZXJyb3IuY29kZSA9PSBcImF1dGgvdXNlci1ub3QtZm91bmRcIikge1xuXHRcdFx0XHRcdFx0XHRhdXRoLmNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZCh1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oc3VjY2Vzc0hhbmRsZXIsIGVycm9ySGFuZGxlcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZXJyb3JIYW5kbGVyKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyA9IGZ1bmN0aW9uKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcm9taXNlLmVycm9yID0gZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS50aGVuKG51bGwsIGZuKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuXHRcdFx0bG9nb3V0OiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGF1dGguc2lnbk91dCgpO1xuXHRcdFx0XHR1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuXHRcdFx0fSxcblxuICAgICAgICAgICAgdXNlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UnLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NoYW5uZWxzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Q2hhbm5lbHNGcm9tOiBmdW5jdGlvbiAoYnVpbGRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MvJyArIGJ1aWxkaW5nICsgXCIvY2hhbm5lbHNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwiYnVpbGRpbmdDb250cm9sbGVyXCIsIGJ1aWxkaW5nQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nQ29udHJvbGxlcigkc2NvcGUsICRpb25pY0xvYWRpbmcsICRzdGF0ZVBhcmFtcywgYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UpIHtcblxuICAgICAgICB2YXIgcmVmID0gYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UuZ2V0Q2hhbm5lbHNGcm9tKCRzdGF0ZVBhcmFtcy5idWlsZGluZ0lkKTtcblxuICAgICAgICAkaW9uaWNMb2FkaW5nLnNob3coKTtcbiAgICAgICAgcmVmLm9uKFwidmFsdWVcIiwgZnVuY3Rpb24gKHNuYXBzaG90KSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gc25hcHNob3QudmFsKCk7XG5cbiAgICAgICAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2hhbm5lbHMgPSBhbmd1bGFyLmV4dGVuZCh2YWwuY29tbW9uLCB2YWwuc2VydmljZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvck9iamVjdCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciByZWFkaW5nOiBcIiArIGVycm9yT2JqZWN0LmNvZGUpO1xuICAgICAgICAgICAgdmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdPcHMhJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ1NvcnJ5ISBBbiBlcnJvciBvY3VycmVkLidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwiYnVpbGRpbmdzQ29udHJvbGxlclwiLCBidWlsZGluZ3NDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdzQ29udHJvbGxlcigkc2NvcGUsICRpb25pY0xvYWRpbmcsIGJ1aWxkaW5nc1NlcnZpY2UpIHtcbiAgICAgICAgdmFyIHJlZiA9IGJ1aWxkaW5nc1NlcnZpY2UuZ2V0QnVpbGRpbmdzKCk7XG5cbiAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG4gICAgICAgIHJlZi5vbihcInZhbHVlXCIsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgICAgICAgJHNjb3BlLmJ1aWxkaW5ncyA9IHNuYXBzaG90LnZhbCgpO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvck9iamVjdCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlcnJvciByZWFkaW5nOiBcIiArIGVycm9yT2JqZWN0LmNvZGUpO1xuICAgICAgICAgICAgdmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdPcHMhJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ1NvcnJ5ISBBbiBlcnJvciBvY3VycmVkJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmJ1aWxkaW5ncycpXG4gICAgICAgIC5zZXJ2aWNlKCdidWlsZGluZ3NTZXJ2aWNlJywgYnVpbGRpbmdzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ3NTZXJ2aWNlKGZpcmViYXNlU2VydmljZSkge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRCdWlsZGluZ3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnKVxuICAgICAgICAuc2VydmljZSgnZmlyZWJhc2VTZXJ2aWNlJywgZmlyZWJhc2VTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gZmlyZWJhc2VTZXJ2aWNlKCkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5OiBcIkFJemFTeUI1cTgxQUdHb3g0aTgtUUwyS090bkREZmkwNWlyZ2NIRVwiLFxuICAgICAgICAgICAgYXV0aERvbWFpbjogXCJzb2NpYWxzdHJhdGFpZGVhdGVhbS5maXJlYmFzZWFwcC5jb21cIixcbiAgICAgICAgICAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vc29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2Vpby5jb21cIixcbiAgICAgICAgICAgIHN0b3JhZ2VCdWNrZXQ6IFwiXCIsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5mYiA9IGZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcbiAgICB9XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5tZXNzYWdlJyk7XG59KSgpO1xuXG5cblxuXG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLm1lc3NhZ2UnKVxuICAgICAgICAuc2VydmljZSgnbWVzc2FnZXNTZXJ2aWNlJywgbWVzc2FnZXNTZXJ2aWNlKTtcblxuICAgIGZ1bmN0aW9uIG1lc3NhZ2VzU2VydmljZSgpIHtcblx0XHR2YXIgb2JqID0ge307XG5cdFx0XG5cdFx0b2JqLmdldE1lc3NhZ2VzUmVmID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCdtZXNzYWdlcycpO1xuXHRcdH07XG5cdFx0XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwicHJvZmlsZUNvbnRyb2xsZXJcIiwgcHJvZmlsZUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBwcm9maWxlQ29udHJvbGxlcigkc2NvcGUsICRpb25pY0xvYWRpbmcsICRpb25pY1BvcHVwLCBhdXRoU2VydmljZSwgcHJvZmlsZXNTZXJ2aWNlKSB7XG5cblx0XHR2YXIgdXNlciA9IGF1dGhTZXJ2aWNlLnVzZXIoKTtcblx0XHRcblx0XHQkc2NvcGUuZGF0YSA9IHtcblx0XHRcdGRpc3BsYXlOYW1lIDogdXNlciA/IHVzZXIuZGlzcGxheU5hbWUgOiBcIlwiLFxuXHRcdFx0ZW1haWwgOiB1c2VyID8gdXNlci5lbWFpbCA6IFwiXCJcblx0XHR9O1xuXG4gICAgICAgICRzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdCRpb25pY0xvYWRpbmcuc2hvdygpO1xuXG4gICAgICAgICAgICBwcm9maWxlc1NlcnZpY2UudXBkYXRlUHJvZmlsZSgkc2NvcGUuZGF0YSkudGhlbihmdW5jdGlvbiBzdWNjZXNzKG1zZykge1xuXHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblxuXHRcdFx0XHQkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnUHJvZmlsZVVwZGF0ZSEnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogbXNnXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XG5cdFx0XHRcdCRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXG5cdFx0XHRcdCRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdVcGRhdGUgZmFpbGVkIScsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJwcm9maWxlc1NlcnZpY2VcIiwgcHJvZmlsZXNTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvZmlsZXNTZXJ2aWNlKCRxLCAkcm9vdFNjb3BlLCBhdXRoU2VydmljZSwgdXNlcikge1xuXHRcdFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlUHJvZmlsZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS51c2VyKCkudXBkYXRlUHJvZmlsZShkYXRhKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShcIlByb2ZpbGUgdXBkYXRlZCFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuc2lkZW1lbnVcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInNpZGVtZW51Q29udHJvbGxlclwiLCBzaWRlbWVudUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBzaWRlbWVudUNvbnRyb2xsZXIoJHNjb3BlLCBhdXRoU2VydmljZSwgbWVzc2FnZXNTZXJ2aWNlKSB7XG5cdFx0JHNjb3BlLiRvbignbmFtZS1jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG5cdFx0XHQkc2NvcGUuZGlzcGxheU5hbWUgPSBhdXRoU2VydmljZS51c2VyKCkuZGlzcGxheU5hbWU7XG5cdFx0fSk7XG5cdFx0XG5cdFx0dmFyIHVzZXIgPSBhdXRoU2VydmljZS51c2VyKCk7XG5cdFx0JHNjb3BlLmRpc3BsYXlOYW1lID0gdXNlciA/IHVzZXIuZGlzcGxheU5hbWUgOiBcIkVkaXQgTmFtZVwiO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAudXNlcnNcIilcblxuICAgICAgICAuc2VydmljZShcInVzZXJzU2VydmljZVwiLCB1c2Vyc1NlcnZpY2UpO1xuXG5cbiAgICBmdW5jdGlvbiB1c2Vyc1NlcnZpY2UoJHEsIGF1dGhTZXJ2aWNlKSB7XG5cdCAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlUHJvZmlsZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS51c2VyKCkudXBkYXRlUHJvZmlsZShkYXRhKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShcIlByb2ZpbGUgdXBkYXRlZCFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnLCBbXG4gICAgICAgICAgICAnaW9uaWMnLFxuXHRcdFx0XG5cdFx0XHQnYXBwLmZpcmViYXNlJyxcbiAgICAgICAgICAgICdhcHAuYXV0aCcsXG4gICAgICAgICAgICAnYXBwLm1lc3NhZ2UnLFxuXHRcdFx0J2FwcC5zaWRlbWVudScsXG4gICAgICAgICAgICAnYXBwLmJ1aWxkaW5ncycsXG4gICAgICAgICAgICAnYXBwLnByb2ZpbGVzJ1xuICAgICAgICBdKVxuXHRcdFxuXHRcdC52YWx1ZShcInVzZXJcIiwgbnVsbClcblxuICAgICAgICAucnVuKGZ1bmN0aW9uICgkaW9uaWNQbGF0Zm9ybSwgJHRpbWVvdXQsICRyb290U2NvcGUpIHtcblx0XHRcdCRpb25pY1BsYXRmb3JtLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmNvcmRvdmEgJiYgd2luZG93LmNvcmRvdmEucGx1Z2lucy5LZXlib2FyZCkge1xuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuaGlkZUtleWJvYXJkQWNjZXNzb3J5QmFyKHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5kaXNhYmxlU2Nyb2xsKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAod2luZG93LlN0YXR1c0Jhcikge1xuICAgICAgICAgICAgICAgICAgICBTdGF0dXNCYXIuc3R5bGVEZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuXHRcdFx0XHRcblx0XHRcdFx0JHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbn0pKCk7XG5cblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJylcblxuICAgICAgICAucnVuKFsnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnYXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHN0YXRlLCBhdXRoU2VydmljZSkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UudXNlcigpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuXHRcdFxuICAgICAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwcCcsXG5cdFx0XHRcdFx0Y2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zaWRlbWVudS5odG1sJyxcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAuYnVpbGRpbmdzJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYnVpbGRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2J1aWxkaW5ncy5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLmJ1aWxkaW5nJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYnVpbGRpbmdzLzpidWlsZGluZ0lkJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2J1aWxkaW5nLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAucHJvZmlsZScsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3Byb2ZpbGUnLFxuXHRcdFx0XHRcdGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcblx0XHRcdFx0XHRcdFx0dGVtcGxhdGVVcmw6ICd2aWV3cy9wcm9maWxlL3Byb2ZpbGUuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cblx0XHRcdFx0LnN0YXRlKCdhcHAubG9nb3V0Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2xvZ2luXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUHJvdmlkZXI6IGZ1bmN0aW9uIChhdXRoU2VydmljZSwgJHN0YXRlKSB7XG5cdFx0XHRcdFx0XHRhdXRoU2VydmljZS5sb2dvdXQoKTtcblx0XHRcdFx0XHRcdCRzdGF0ZS5nbygnbG9naW4nKTtcblx0XHRcdFx0XHR9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2xvZ2luJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2xvZ2luXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcInZpZXdzL2F1dGgvbG9naW4uaHRtbFwiXG4gICAgICAgICAgICAgICAgfSk7XG5cdFx0XHRcdFxuXG4gICAgICAgICAgICAvL2ZhbGxiYWNrXG4gICAgICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvbG9naW4nKTtcblxuICAgICAgICB9KTtcbn0pKCk7XG5cblxuXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
