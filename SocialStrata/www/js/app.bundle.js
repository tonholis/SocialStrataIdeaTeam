!function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.firebase",[])}(),function(){"use strict";angular.module("app.buildings",["app.firebase"])}(),function(){"use strict";angular.module("app.profiles",[])}(),function(){"use strict";angular.module("app.sidemenu",[])}(),function(){"use strict";function e(e,n,i,t,r,o){e.data={},e.login=function(){t.show(),n.login(e.data.username,e.data.password).success(function(e){t.hide(),r.go("app.buildings")}).error(function(e){o(function(){t.hide()},100);i.alert({title:"Login failed!",template:e.message})})},e.facebookLogin=function(){i.alert({title:"Facebook login",template:"Planned!"})}}e.$inject=["$scope","authService","$ionicPopup","$ionicLoading","$state","$timeout"],angular.module("app.auth").controller("authController",e)}(),function(){"use strict";function e(e,n){var i=n.fb.auth();return{login:function(n,t){var r=e.defer(),o=r.promise,a=function(e){e.isNew=null==e.displayName,r.resolve(e)},u=function(e){r.reject(e)};return i.signInWithEmailAndPassword(n,t).then(a,function l(l){"auth/user-not-found"==l.code?i.createUserWithEmailAndPassword(n,t).then(a,u):u(l)}),o.success=function(e){return o.then(e),o},o.error=function(e){return o.then(null,e),o},o},user:function(){return i.currentUser}}}e.$inject=["$q","firebaseService"],angular.module("app.auth").service("authService",e)}(),function(){"use strict";function e(){var e={apiKey:"AIzaSyB5q81AGGox4i8-QL2KOtnDDfi05irgcHE",authDomain:"socialstrataideateam.firebaseapp.com",databaseURL:"https://socialstrataideateam.firebaseio.com",storageBucket:""};this.fb=firebase.initializeApp(e)}angular.module("app.firebase").service("firebaseService",e)}(),function(){"use strict";function e(e){return{getChannelsFrom:function(n){return e.fb.database().ref("buildings/"+n+"/channels")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingChannelsService",e)}(),function(){"use strict";function e(e,n,i,t){var r=t.getChannelsFrom(i.buildingId);n.show(),r.on("value",function(i){var t=i.val();t&&(e.channels=angular.extend(t.common,t.services)),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred."});n.hide()})}e.$inject=["$scope","$ionicLoading","$stateParams","buildingChannelsService"],angular.module("app.buildings").controller("buildingController",e)}(),function(){"use strict";function e(e,n,i){var t=i.getBuildings();n.show(),t.on("value",function(i){e.buildings=i.val(),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred"});n.hide()})}e.$inject=["$scope","$ionicLoading","buildingsService"],angular.module("app.buildings").controller("buildingsController",e)}(),function(){"use strict";function e(e){return{getBuildings:function(){return e.fb.database().ref("buildings")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingsService",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("app.profiles").controller("landlordProfileController",e)}(),function(){"use strict";function e(e){console.log("tenantProfileController")}e.$inject=["$scope"],angular.module("app.profiles").controller("tenantProfileController",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("app.sidemenu").controller("sidemenuController",e)}(),function(){"use strict";angular.module("app",["ionic","app.firebase","app.auth","app.sidemenu","app.buildings","app.profiles"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}])}(),function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("app",{url:"/app","abstract":!0,templateUrl:"views/sidemenu.html"}).state("app.buildings",{url:"/buildings",views:{menuContent:{templateUrl:"views/buildings.html"}}}).state("app.building",{url:"/buildings/:buildingId",views:{menuContent:{templateUrl:"views/building.html"}}}).state("app.profile",{url:"/profile",resolve:{user:["authService",function(e){return e.user()}]},views:{menuContent:{templateProvider:["$timeout","$stateParams","user",function(e,n,i){console.log(i);var t=null;return t=1==i.type?"views/profile/landlord.html":"views/profile/tenant.html",console.log(t),t}]}}}).state("login",{url:"/login",templateUrl:"views/auth/login.html"}),n.otherwise("/login")}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5tb2R1bGUuanMiLCJmaXJlYmFzZS9maXJlYmFzZS5tb2R1bGUuanMiLCJidWlsZGluZ3MvYnVpbGRpbmdzLm1vZHVsZS5qcyIsInByb2ZpbGUvcHJvZmlsZXMubW9kdWxlLmpzIiwic2lkZW1lbnUvc2lkZW1lbnUubW9kdWxlLmpzIiwiYXV0aC9hdXRoQ29udHJvbGxlci5qcyIsImFwcC5idW5kbGUuanMiLCJhdXRoL2F1dGhTZXJ2aWNlLmpzIiwiZmlyZWJhc2UvZmlyZWJhc2VTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ29udHJvbGxlci5qcyIsImJ1aWxkaW5ncy9idWlsZGluZ3NDb250cm9sbGVyLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nc1NlcnZpY2UuanMiLCJwcm9maWxlL2xhbmRsb3JkUHJvZmlsZUNvbnRyb2xsZXIuanMiLCJwcm9maWxlL3RlbmFudFByb2ZpbGVDb250cm9sbGVyLmpzIiwic2lkZW1lbnUvc2lkZW1lbnVDb250cm9sbGVyLmpzIiwiYXBwLm1vZHVsZS5qcyIsImFwcC5yb3V0ZXIuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImF1dGhDb250cm9sbGVyIiwiJHNjb3BlIiwiYXV0aFNlcnZpY2UiLCIkaW9uaWNQb3B1cCIsIiRpb25pY0xvYWRpbmciLCIkc3RhdGUiLCIkdGltZW91dCIsImRhdGEiLCJsb2dpbiIsInNob3ciLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwic3VjY2VzcyIsInVzZXIiLCJoaWRlIiwiZ28iLCJlcnJvciIsImFsZXJ0IiwidGl0bGUiLCJ0ZW1wbGF0ZSIsIm1lc3NhZ2UiLCJmYWNlYm9va0xvZ2luIiwiJGluamVjdCIsImNvbnRyb2xsZXIiLCIkcSIsImZpcmViYXNlU2VydmljZSIsImF1dGgiLCJmYiIsImRlZmVycmVkIiwiZGVmZXIiLCJwcm9taXNlIiwic3VjY2Vzc0hhbmRsZXIiLCJpbmZvIiwiaXNOZXciLCJkaXNwbGF5TmFtZSIsInJlc29sdmUiLCJlcnJvckhhbmRsZXIiLCJyZWplY3QiLCJzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCIsInRoZW4iLCJjb2RlIiwiY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkIiwiZm4iLCJjdXJyZW50VXNlciIsInNlcnZpY2UiLCJjb25maWciLCJhcGlLZXkiLCJhdXRoRG9tYWluIiwiZGF0YWJhc2VVUkwiLCJzdG9yYWdlQnVja2V0IiwidGhpcyIsImZpcmViYXNlIiwiaW5pdGlhbGl6ZUFwcCIsImJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlIiwiZ2V0Q2hhbm5lbHNGcm9tIiwiYnVpbGRpbmciLCJkYXRhYmFzZSIsInJlZiIsImJ1aWxkaW5nQ29udHJvbGxlciIsIiRzdGF0ZVBhcmFtcyIsImJ1aWxkaW5nSWQiLCJvbiIsInNuYXBzaG90IiwidmFsIiwiY2hhbm5lbHMiLCJleHRlbmQiLCJjb21tb24iLCJzZXJ2aWNlcyIsImVycm9yT2JqZWN0IiwiY29uc29sZSIsImxvZyIsImJ1aWxkaW5nc0NvbnRyb2xsZXIiLCJidWlsZGluZ3NTZXJ2aWNlIiwiZ2V0QnVpbGRpbmdzIiwiYnVpbGRpbmdzIiwibGFuZGxvcmRQcm9maWxlQ29udHJvbGxlciIsInRlbmFudFByb2ZpbGVDb250cm9sbGVyIiwic2lkZW1lbnVDb250cm9sbGVyIiwicnVuIiwiJGlvbmljUGxhdGZvcm0iLCJyZWFkeSIsIndpbmRvdyIsImNvcmRvdmEiLCJwbHVnaW5zIiwiS2V5Ym9hcmQiLCJoaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIiLCJkaXNhYmxlU2Nyb2xsIiwiU3RhdHVzQmFyIiwic3R5bGVEZWZhdWx0IiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsImFic3RyYWN0IiwidGVtcGxhdGVVcmwiLCJ2aWV3cyIsIm1lbnVDb250ZW50IiwidGVtcGxhdGVQcm92aWRlciIsInZpZXciLCJ0eXBlIiwib3RoZXJ3aXNl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R0FDQUEsRUFBQUMsTUFBQSxXQUNBQyxPQUFBQyxTQUFBRCxPQUFBQyxRQUFBQyxRQUFBQyxXQUNBRixRQUFBQyxRQUFBQyxTQUFBQywwQkFBQSxHQUVBSCxRQUFBQyxRQUFBQyxTQUFBRSxlQUFBLElBRUFMLE9BQUFNLFdBQ0FBLFVBQUFDLHVCQ3ZCQSxXQUNBLFlBRUExRixTQUVBQyxPQUFBLE9BRUE4QyxRQUFBLGlCQUFBLHFCQUFBLFNBQUE0QyxFQUFBQyxHQUVBRCxFQUVBRSxNQUFBLE9BQ0FDLElBQUEsT0FDQUMsWUFBQSxFQUNBQyxZQUFBLHdCQUdBSCxNQUFBLGlCQUNBQyxJQUFBLGFBQ0FHLE9BQ0FDLGFBQ0FGLFlBQUEsMkJBS0FILE1BQUEsZ0JBQ0FDLElBQUEseUJBQ0FHLE9BQ0FDLGFBQ0FGLFlBQUEsMEJBS0FILE1BQUEsZUFDQUMsSUFBQSxXQUNBekQsU0FDQXRCLE1BQUEsY0FBQSxTQUFBWCxHQUNBLE1BQUFBLEdBQUFXLFVBR0FrRixPQUNBQyxhQUNBQyxrQkFBQSxXQUFBLGVBQUEsT0FBQSxTQUFBM0YsRUFBQXFELEVBQUE5QyxHQUNBd0QsUUFBQUMsSUFBQXpELEVBQ0EsSUFBQXFGLEdBQUEsSUFVQSxPQVBBQSxHQURBLEdBQUFyRixFQUFBc0YsS0FDQSw4QkFFQSw0QkFHQTlCLFFBQUFDLElBQUE0QixHQUVBQSxRQU1BUCxNQUFBLFNBQ0FDLElBQUEsU0FDQUUsWUFBQSwwQkFJQUosRUFBQVUsVUFBQSIsImZpbGUiOiJhcHAuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmZpcmViYXNlJywgW10pO1xufSkoKTtcblxuXG5cblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIiwgWydhcHAuZmlyZWJhc2UnXSk7XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIiwgW10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnNpZGVtZW51XCIsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmF1dGhcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImF1dGhDb250cm9sbGVyXCIsIGF1dGhDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYXV0aENvbnRyb2xsZXIoJHNjb3BlLCBhdXRoU2VydmljZSwgJGlvbmljUG9wdXAsICRpb25pY0xvYWRpbmcsICRzdGF0ZSwgJHRpbWVvdXQpIHtcblxuICAgICAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0JGlvbmljTG9hZGluZy5zaG93KCk7XG5cblx0XHRcdGF1dGhTZXJ2aWNlLmxvZ2luKCRzY29wZS5kYXRhLnVzZXJuYW1lLCAkc2NvcGUuZGF0YS5wYXNzd29yZCkuc3VjY2VzcyhmdW5jdGlvbih1c2VyKSB7XG5cdFx0XHRcdCRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXHRcdFx0XHQkc3RhdGUuZ28oJ2FwcC5idWlsZGluZ3MnKTtcblxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdFx0JHRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cdFx0XHRcdH0sIDEwMCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdMb2dpbiBmYWlsZWQhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IGVycm9yLm1lc3NhZ2UgLy8nUGxlYXNlIGNoZWNrIHlvdXIgY3JlZGVudGlhbHMhJ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXHRcdCRzY29wZS5mYWNlYm9va0xvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcblx0XHRcdFx0dGl0bGU6ICdGYWNlYm9vayBsb2dpbicsXG5cdFx0XHRcdHRlbXBsYXRlOiAnUGxhbm5lZCEnXG5cdFx0XHR9KTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIsIFtdKTtcbn0pKCk7XG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnLCBbXSk7XG59KSgpO1xuXG5cblxuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIsIFsnYXBwLmZpcmViYXNlJ10pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIiwgW10pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuc2lkZW1lbnVcIiwgW10pO1xufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhdXRoQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCIkaW9uaWNQb3B1cFwiLCBcIiRpb25pY0xvYWRpbmdcIiwgXCIkc3RhdGVcIiwgXCIkdGltZW91dFwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJhdXRoQ29udHJvbGxlclwiLCBhdXRoQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGF1dGhDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsICRpb25pY1BvcHVwLCAkaW9uaWNMb2FkaW5nLCAkc3RhdGUsICR0aW1lb3V0KSB7XG5cbiAgICAgICAgJHNjb3BlLmRhdGEgPSB7fTtcblxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcblx0XHRcdCRpb25pY0xvYWRpbmcuc2hvdygpO1xuXG5cdFx0XHRhdXRoU2VydmljZS5sb2dpbigkc2NvcGUuZGF0YS51c2VybmFtZSwgJHNjb3BlLmRhdGEucGFzc3dvcmQpLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xuXHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblx0XHRcdFx0JHN0YXRlLmdvKCdhcHAuYnVpbGRpbmdzJyk7XG5cbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHRcdCR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXHRcdFx0XHR9LCAxMDApO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTG9naW4gZmFpbGVkIScsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBlcnJvci5tZXNzYWdlIC8vJ1BsZWFzZSBjaGVjayB5b3VyIGNyZWRlbnRpYWxzISdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cblx0XHQkc2NvcGUuZmFjZWJvb2tMb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG5cdFx0XHRcdHRpdGxlOiAnRmFjZWJvb2sgbG9naW4nLFxuXHRcdFx0XHR0ZW1wbGF0ZTogJ1BsYW5uZWQhJ1xuXHRcdFx0fSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcVwiLCBcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJhdXRoU2VydmljZVwiLCBhdXRoU2VydmljZSk7XG5cblx0ZnVuY3Rpb24gY3JlYXRlVXNlcih1c2VybmFtZSwgcGFzc3dvcmQpIHtcblx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXHRcdHZhciBhdXRoID0gZmlyZWJhc2VTZXJ2aWNlLmZiLmF1dGgoKTtcblxuXHRcdHJldHVybiBhdXRoLmNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZChlbWFpbCwgcGFzc3dvcmQpO1xuXHR9XG5cbiAgICBmdW5jdGlvbiBhdXRoU2VydmljZSgkcSwgZmlyZWJhc2VTZXJ2aWNlKSB7XG5cdFx0dmFyIGF1dGggPSBmaXJlYmFzZVNlcnZpY2UuZmIuYXV0aCgpO1xuXG5cdFx0cmV0dXJuIHtcbiAgICAgICAgICAgIGxvZ2luOiBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcblxuXHRcdFx0XHR2YXIgc3VjY2Vzc0hhbmRsZXIgPSBmdW5jdGlvbihpbmZvKSB7XG5cdFx0XHRcdFx0aW5mby5pc05ldyA9IGluZm8uZGlzcGxheU5hbWUgPT0gbnVsbDtcblx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGluZm8pO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdHZhciBlcnJvckhhbmRsZXIgPSBmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0XHRcdGRlZmVycmVkLnJlamVjdChlcnJvcik7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0YXV0aC5zaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCh1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0LnRoZW4oc3VjY2Vzc0hhbmRsZXIsIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XG5cdFx0XHRcdFx0XHRpZiAoZXJyb3IuY29kZSA9PSBcImF1dGgvdXNlci1ub3QtZm91bmRcIikge1xuXHRcdFx0XHRcdFx0XHRhdXRoLmNyZWF0ZVVzZXJXaXRoRW1haWxBbmRQYXNzd29yZCh1c2VybmFtZSwgcGFzc3dvcmQpXG5cdFx0XHRcdFx0XHRcdFx0LnRoZW4oc3VjY2Vzc0hhbmRsZXIsIGVycm9ySGFuZGxlcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZXJyb3JIYW5kbGVyKGVycm9yKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblxuICAgICAgICAgICAgICAgIHByb21pc2Uuc3VjY2VzcyA9IGZ1bmN0aW9uKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihmbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBwcm9taXNlLmVycm9yID0gZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS50aGVuKG51bGwsIGZuKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdXNlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBhdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgICAgIC8vIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLy8gICAgIHVzZXJuYW1lOiBcInVzZXJcIixcbiAgICAgICAgICAgICAgICAvLyAgICAgcGFzc3dvcmQ6IFwicGFzc3dvcmRcIixcbiAgICAgICAgICAgICAgICAvLyAgICAgdHlwZTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgKyAxXG4gICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5maXJlYmFzZScpXG4gICAgICAgIC5zZXJ2aWNlKCdmaXJlYmFzZVNlcnZpY2UnLCBmaXJlYmFzZVNlcnZpY2UpO1xuXG5cbiAgICBmdW5jdGlvbiBmaXJlYmFzZVNlcnZpY2UoKSB7XG4gICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICBhcGlLZXk6IFwiQUl6YVN5QjVxODFBR0dveDRpOC1RTDJLT3RuRERmaTA1aXJnY0hFXCIsXG4gICAgICAgICAgICBhdXRoRG9tYWluOiBcInNvY2lhbHN0cmF0YWlkZWF0ZWFtLmZpcmViYXNlYXBwLmNvbVwiLFxuICAgICAgICAgICAgZGF0YWJhc2VVUkw6IFwiaHR0cHM6Ly9zb2NpYWxzdHJhdGFpZGVhdGVhbS5maXJlYmFzZWlvLmNvbVwiLFxuICAgICAgICAgICAgc3RvcmFnZUJ1Y2tldDogXCJcIixcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmZiID0gZmlyZWJhc2UuaW5pdGlhbGl6ZUFwcChjb25maWcpO1xuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UnLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NoYW5uZWxzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0Q2hhbm5lbHNGcm9tOiBmdW5jdGlvbiAoYnVpbGRpbmcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmlyZWJhc2VTZXJ2aWNlLmZiLmRhdGFiYXNlKCkucmVmKCdidWlsZGluZ3MvJyArIGJ1aWxkaW5nICsgXCIvY2hhbm5lbHNcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYnVpbGRpbmdDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiYnVpbGRpbmdDaGFubmVsc1NlcnZpY2VcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJidWlsZGluZ0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdDb250cm9sbGVyKCRzY29wZSwgJGlvbmljTG9hZGluZywgJHN0YXRlUGFyYW1zLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSkge1xuXG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ0NoYW5uZWxzU2VydmljZS5nZXRDaGFubmVsc0Zyb20oJHN0YXRlUGFyYW1zLmJ1aWxkaW5nSWQpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSBzbmFwc2hvdC52YWwoKTtcblxuICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5jaGFubmVscyA9IGFuZ3VsYXIuZXh0ZW5kKHZhbC5jb21tb24sIHZhbC5zZXJ2aWNlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG5cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yT2JqZWN0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHJlYWRpbmc6IFwiICsgZXJyb3JPYmplY3QuY29kZSk7XG4gICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ09wcyEnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnU29ycnkhIEFuIGVycm9yIG9jdXJyZWQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBidWlsZGluZ3NDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaW9uaWNMb2FkaW5nXCIsIFwiYnVpbGRpbmdzU2VydmljZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nc0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdzQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCBidWlsZGluZ3NTZXJ2aWNlKSB7XG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ3NTZXJ2aWNlLmdldEJ1aWxkaW5ncygpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgICRzY29wZS5idWlsZGluZ3MgPSBzbmFwc2hvdC52YWwoKTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGJ1aWxkaW5nc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiXTtcbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdzU2VydmljZScsIGJ1aWxkaW5nc1NlcnZpY2UpO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0QnVpbGRpbmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcmViYXNlU2VydmljZS5mYi5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgbGFuZGxvcmRQcm9maWxlQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCJdO1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJsYW5kbG9yZFByb2ZpbGVDb250cm9sbGVyXCIsIGxhbmRsb3JkUHJvZmlsZUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBsYW5kbG9yZFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSkge1xuXG4gICAgfVxufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdGVuYW50UHJvZmlsZUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwidGVuYW50UHJvZmlsZUNvbnRyb2xsZXJcIiwgdGVuYW50UHJvZmlsZUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiB0ZW5hbnRQcm9maWxlQ29udHJvbGxlcigkc2NvcGUpIHtcblx0XHRjb25zb2xlLmxvZyhcInRlbmFudFByb2ZpbGVDb250cm9sbGVyXCIpO1xuXG4gICAgfVxufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgc2lkZW1lbnVDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuc2lkZW1lbnVcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInNpZGVtZW51Q29udHJvbGxlclwiLCBzaWRlbWVudUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBzaWRlbWVudUNvbnRyb2xsZXIoJHNjb3BlKSB7XG5cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJywgW1xuICAgICAgICAgICAgJ2lvbmljJyxcblx0XHRcdFxuXHRcdFx0J2FwcC5maXJlYmFzZScsXG4gICAgICAgICAgICAnYXBwLmF1dGgnLFxuICAgICAgICAgICAgJ2FwcC5zaWRlbWVudScsXG4gICAgICAgICAgICAnYXBwLmJ1aWxkaW5ncycsXG4gICAgICAgICAgICAnYXBwLnByb2ZpbGVzJ1xuICAgICAgICBdKVxuXG4gICAgICAgIC5ydW4oW1wiJGlvbmljUGxhdGZvcm1cIiwgZnVuY3Rpb24gKCRpb25pY1BsYXRmb3JtKSB7XG4gICAgICAgICAgICAkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuZGlzYWJsZVNjcm9sbCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5TdGF0dXNCYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgU3RhdHVzQmFyLnN0eWxlRGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSk7XG59KSgpO1xuXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJylcblxuICAgICAgICAuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwcCcsXG4gICAgICAgICAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL3NpZGVtZW51Lmh0bWwnLFxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5idWlsZGluZ3MnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9idWlsZGluZ3MnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYnVpbGRpbmdzLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAuYnVpbGRpbmcnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9idWlsZGluZ3MvOmJ1aWxkaW5nSWQnLFxuICAgICAgICAgICAgICAgICAgICB2aWV3czoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ21lbnVDb250ZW50Jzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvYnVpbGRpbmcuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5wcm9maWxlJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcHJvZmlsZScsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXI6IFtcImF1dGhTZXJ2aWNlXCIsIGZ1bmN0aW9uIChhdXRoU2VydmljZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhdXRoU2VydmljZS51c2VyKClcbiAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVQcm92aWRlcjogW1wiJHRpbWVvdXRcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCJ1c2VyXCIsIGZ1bmN0aW9uICgkdGltZW91dCwgJHN0YXRlUGFyYW1zLCB1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmlldyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIudHlwZSA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3ID0gJ3ZpZXdzL3Byb2ZpbGUvbGFuZGxvcmQuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSAndmlld3MvcHJvZmlsZS90ZW5hbnQuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZpZXcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2aWV3O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9sb2dpblwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9hdXRoL2xvZ2luLmh0bWxcIlxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL2ZhbGxiYWNrXG4gICAgICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvbG9naW4nKTtcblxuICAgICAgICB9XSk7XG59KSgpO1xuXG5cblxuXG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiKVxuXG4gICAgICAgIC5zZXJ2aWNlKFwiYXV0aFNlcnZpY2VcIiwgYXV0aFNlcnZpY2UpO1xuXG5cdGZ1bmN0aW9uIGNyZWF0ZVVzZXIodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblx0XHR2YXIgYXV0aCA9IGZpcmViYXNlU2VydmljZS5mYi5hdXRoKCk7XG5cblx0XHRyZXR1cm4gYXV0aC5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKTtcblx0fVxuXG4gICAgZnVuY3Rpb24gYXV0aFNlcnZpY2UoJHEsIGZpcmViYXNlU2VydmljZSkge1xuXHRcdHZhciBhdXRoID0gZmlyZWJhc2VTZXJ2aWNlLmZiLmF1dGgoKTtcblxuXHRcdHJldHVybiB7XG4gICAgICAgICAgICBsb2dpbjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IGRlZmVycmVkLnByb21pc2U7XG5cblx0XHRcdFx0dmFyIHN1Y2Nlc3NIYW5kbGVyID0gZnVuY3Rpb24oaW5mbykge1xuXHRcdFx0XHRcdGluZm8uaXNOZXcgPSBpbmZvLmRpc3BsYXlOYW1lID09IG51bGw7XG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShpbmZvKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHR2YXIgZXJyb3JIYW5kbGVyID0gZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGF1dGguc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHRcdC50aGVuKHN1Y2Nlc3NIYW5kbGVyLCBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yLmNvZGUgPT0gXCJhdXRoL3VzZXItbm90LWZvdW5kXCIpIHtcblx0XHRcdFx0XHRcdFx0YXV0aC5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHRcdFx0XHRcdC50aGVuKHN1Y2Nlc3NIYW5kbGVyLCBlcnJvckhhbmRsZXIpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGVycm9ySGFuZGxlcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MgPSBmdW5jdGlvbihmbikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZm4pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5lcnJvciA9IGZ1bmN0aW9uKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihudWxsLCBmbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIHVzZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gYXV0aC5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC8vICAgICB1c2VybmFtZTogXCJ1c2VyXCIsXG4gICAgICAgICAgICAgICAgLy8gICAgIHBhc3N3b3JkOiBcInBhc3N3b3JkXCIsXG4gICAgICAgICAgICAgICAgLy8gICAgIHR5cGU6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMVxuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmZpcmViYXNlJylcbiAgICAgICAgLnNlcnZpY2UoJ2ZpcmViYXNlU2VydmljZScsIGZpcmViYXNlU2VydmljZSk7XG5cblxuICAgIGZ1bmN0aW9uIGZpcmViYXNlU2VydmljZSgpIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgIGFwaUtleTogXCJBSXphU3lCNXE4MUFHR294NGk4LVFMMktPdG5ERGZpMDVpcmdjSEVcIixcbiAgICAgICAgICAgIGF1dGhEb21haW46IFwic29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2VhcHAuY29tXCIsXG4gICAgICAgICAgICBkYXRhYmFzZVVSTDogXCJodHRwczovL3NvY2lhbHN0cmF0YWlkZWF0ZWFtLmZpcmViYXNlaW8uY29tXCIsXG4gICAgICAgICAgICBzdG9yYWdlQnVja2V0OiBcIlwiLFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZmIgPSBmaXJlYmFzZS5pbml0aWFsaXplQXBwKGNvbmZpZyk7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuYnVpbGRpbmdzJylcbiAgICAgICAgLnNlcnZpY2UoJ2J1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlJywgYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UpO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdDaGFubmVsc1NlcnZpY2UoZmlyZWJhc2VTZXJ2aWNlKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldENoYW5uZWxzRnJvbTogZnVuY3Rpb24gKGJ1aWxkaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcmViYXNlU2VydmljZS5mYi5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzLycgKyBidWlsZGluZyArIFwiL2NoYW5uZWxzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nQ29udHJvbGxlclwiLCBidWlsZGluZ0NvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCAkc3RhdGVQYXJhbXMsIGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIHJlZiA9IGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlLmdldENoYW5uZWxzRnJvbSgkc3RhdGVQYXJhbXMuYnVpbGRpbmdJZCk7XG5cbiAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG4gICAgICAgIHJlZi5vbihcInZhbHVlXCIsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgICAgICAgdmFyIHZhbCA9IHNuYXBzaG90LnZhbCgpO1xuXG4gICAgICAgICAgICBpZiAodmFsKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYW5uZWxzID0gYW5ndWxhci5leHRlbmQodmFsLmNvbW1vbiwgdmFsLnNlcnZpY2VzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZC4nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9KTtcblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nc0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdzQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCBidWlsZGluZ3NTZXJ2aWNlKSB7XG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ3NTZXJ2aWNlLmdldEJ1aWxkaW5ncygpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgICRzY29wZS5idWlsZGluZ3MgPSBzbmFwc2hvdC52YWwoKTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5idWlsZGluZ3MnKVxuICAgICAgICAuc2VydmljZSgnYnVpbGRpbmdzU2VydmljZScsIGJ1aWxkaW5nc1NlcnZpY2UpO1xuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdzU2VydmljZShmaXJlYmFzZVNlcnZpY2UpIHtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZ2V0QnVpbGRpbmdzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpcmViYXNlU2VydmljZS5mYi5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJsYW5kbG9yZFByb2ZpbGVDb250cm9sbGVyXCIsIGxhbmRsb3JkUHJvZmlsZUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBsYW5kbG9yZFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSkge1xuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJ0ZW5hbnRQcm9maWxlQ29udHJvbGxlclwiLCB0ZW5hbnRQcm9maWxlQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIHRlbmFudFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSkge1xuXHRcdGNvbnNvbGUubG9nKFwidGVuYW50UHJvZmlsZUNvbnRyb2xsZXJcIik7XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuc2lkZW1lbnVcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInNpZGVtZW51Q29udHJvbGxlclwiLCBzaWRlbWVudUNvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBzaWRlbWVudUNvbnRyb2xsZXIoJHNjb3BlKSB7XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcsIFtcbiAgICAgICAgICAgICdpb25pYycsXG5cdFx0XHRcblx0XHRcdCdhcHAuZmlyZWJhc2UnLFxuICAgICAgICAgICAgJ2FwcC5hdXRoJyxcbiAgICAgICAgICAgICdhcHAuc2lkZW1lbnUnLFxuICAgICAgICAgICAgJ2FwcC5idWlsZGluZ3MnLFxuICAgICAgICAgICAgJ2FwcC5wcm9maWxlcydcbiAgICAgICAgXSlcblxuICAgICAgICAucnVuKGZ1bmN0aW9uICgkaW9uaWNQbGF0Zm9ybSkge1xuICAgICAgICAgICAgJGlvbmljUGxhdGZvcm0ucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuY29yZG92YSAmJiB3aW5kb3cuY29yZG92YS5wbHVnaW5zLktleWJvYXJkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcmRvdmEucGx1Z2lucy5LZXlib2FyZC5oaWRlS2V5Ym9hcmRBY2Nlc3NvcnlCYXIodHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmRpc2FibGVTY3JvbGwodHJ1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuU3RhdHVzQmFyKSB7XG4gICAgICAgICAgICAgICAgICAgIFN0YXR1c0Jhci5zdHlsZURlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG59KSgpO1xuXG5cbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG5cbiAgICAgICAgLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hcHAnLFxuICAgICAgICAgICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zaWRlbWVudS5odG1sJyxcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAuYnVpbGRpbmdzJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYnVpbGRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2J1aWxkaW5ncy5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLmJ1aWxkaW5nJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYnVpbGRpbmdzLzpidWlsZGluZ0lkJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2J1aWxkaW5nLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAucHJvZmlsZScsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3Byb2ZpbGUnLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyOiBmdW5jdGlvbiAoYXV0aFNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aFNlcnZpY2UudXNlcigpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVQcm92aWRlcjogZnVuY3Rpb24gKCR0aW1lb3V0LCAkc3RhdGVQYXJhbXMsIHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codXNlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2aWV3ID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci50eXBlID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSAndmlld3MvcHJvZmlsZS9sYW5kbG9yZC5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9ICd2aWV3cy9wcm9maWxlL3RlbmFudC5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codmlldyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnbG9naW4nLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvbG9naW5cIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwidmlld3MvYXV0aC9sb2dpbi5odG1sXCJcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9mYWxsYmFja1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XG5cbiAgICAgICAgfSk7XG59KSgpO1xuXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
