!function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.buildings",["app.firebase"])}(),function(){"use strict";angular.module("app.firebase",[])}(),function(){"use strict";angular.module("app.message",[])}(),function(){"use strict";angular.module("app.profiles",["app.auth"])}(),function(){"use strict";angular.module("app.sidemenu",[])}(),function(){"use strict";angular.module("app.users",["app.auth"])}(),function(){"use strict";function e(e,n,i,t,a,r){e.data={},e.login=function(){t.show(),n.login(e.data.username,e.data.password).success(function(e){t.hide(),a.go("app.buildings")}).error(function(e){r(function(){t.hide()},100);i.alert({title:"Login failed!",template:e.message})})},e.facebookLogin=function(){i.alert({title:"Facebook login",template:"Planned!"})}}e.$inject=["$scope","authService","$ionicPopup","$ionicLoading","$state","$timeout"],angular.module("app.auth").controller("authController",e)}(),function(){"use strict";function e(e,n,i,t,a){var r=firebase.auth();return n.$on("name-changed",function(){var e=firebase.auth().currentUser;null!=e&&firebase.database().ref("users/"+e.uid).set({name:e.displayName,email:e.email,lastActivity:(new Date).getTime()})}),{login:function(t,a){var u=e.defer(),o=u.promise,s=function(e){e.isNew=null==e.displayName,u.resolve(e),i=firebase.auth().currentUser,n.$emit("name-changed")},l=function(e){u.reject(e)};return r.signInWithEmailAndPassword(t,a).then(s,function c(c){"auth/user-not-found"==c.code?r.createUserWithEmailAndPassword(t,a).then(s,l):l(c)}),o.success=function(e){return o.then(e),o},o.error=function(e){return o.then(null,e),o},o},logout:function(){r.signOut(),i=firebase.auth().currentUser},user:function(){return firebase.auth().currentUser}}}e.$inject=["$q","$rootScope","user","buildingsService","selectedBuilding"],angular.module("app.auth").service("authService",e)}(),function(){"use strict";function e(e){return{getChannelsFrom:function(n){return e.fb.database().ref("buildings/"+n+"/channels")}}}e.$inject=["firebaseService"],angular.module("app.buildings").service("buildingChannelsService",e)}(),function(){"use strict";function e(e,n,i,t){var a=t.getChannelsFrom(i.buildingId);n.show(),a.on("value",function(i){var t=i.val();t&&(e.channels=angular.extend(t.common,t.services)),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred."});n.hide()})}e.$inject=["$scope","$ionicLoading","$stateParams","buildingChannelsService"],angular.module("app.buildings").controller("buildingController",e)}(),function(){"use strict";function e(e,n,i,t){var a=i.getBuildings();e.selectedKey=t?t.key:null,e.select=function(n,i){e.selectedKey=i.key=n,t=i,e.$emit("building-selected",t)},n.show(),a.on("value",function(i){e.buildings=i.val(),n.hide()},function(e){console.log("error reading: "+e.code);$ionicPopup.alert({title:"Ops!",template:"Sorry! An error ocurred"});n.hide()})}e.$inject=["$scope","$ionicLoading","buildingsService","selectedBuilding"],angular.module("app.buildings").controller("buildingsController",e)}(),function(){"use strict";function e(e,n){return{getBuildings:function(){return firebase.database().ref("buildings")}}}e.$inject=["firebaseService","$rootScope"],angular.module("app.buildings").service("buildingsService",e)}(),function(){"use strict";function e(){var e={apiKey:"AIzaSyB5q81AGGox4i8-QL2KOtnDDfi05irgcHE",authDomain:"socialstrataideateam.firebaseapp.com",databaseURL:"https://socialstrataideateam.firebaseio.com",storageBucket:""};this.fb=firebase.initializeApp(e)}angular.module("app.firebase").service("firebaseService",e)}(),function(){"use strict";angular.module("app.message")}(),function(){"use strict";function e(){var e={};return e.getMessagesRef=function(){return firebase.database().ref("messages")},e.getMessagesRef=function(){return firebase.database().ref("messages")},e}angular.module("app.message").service("messagesService",e)}(),function(){"use strict";function e(e,n,i,t,a){var r=t.user();e.data={displayName:r?r.displayName:"",email:r?r.email:""},e.update=function(){n.show(),a.updateProfile(e.data).then(function(e){n.hide(),i.alert({title:"ProfileUpdate!",template:e})},function t(t){n.hide(),i.alert({title:"Update failed!",template:t.message})})}}e.$inject=["$scope","$ionicLoading","$ionicPopup","authService","profilesService"],angular.module("app.profiles").controller("profileController",e)}(),function(){"use strict";function e(e,n,i,t){return{updateProfile:function(a){var r=e.defer();return i.user().updateProfile(a).then(function(){r.resolve("Profile updated!"),t=firebase.auth().currentUser,n.$broadcast("name-changed")},function u(u){r.reject(u)}),r.promise}}}e.$inject=["$q","$rootScope","authService","user"],angular.module("app.profiles").service("profilesService",e)}(),function(){"use strict";function e(e,n){e.building={name:"Select a building",address:""},e.$on("building-selected",function(n,i){e.building.name=i.name,e.building.address=i.address}),e.channel=function(e){}}e.$inject=["$scope","$state"],angular.module("app.sidemenu").controller("sidemenuController",e)}(),function(){"use strict";function e(e,n){return{updateProfile:function(i){var t=e.defer();return n.user().updateProfile(i).then(function(){t.resolve("Profile updated!"),user=firebase.auth().currentUser,$rootScope.$broadcast("name-changed")},function a(a){t.reject(a)}),t.promise}}}e.$inject=["$q","authService"],angular.module("app.users").service("usersService",e)}(),function(){"use strict";angular.module("app",["ionic","app.firebase","app.auth","app.message","app.sidemenu","app.buildings","app.profiles"]).value("user",null).value("selectedBuilding",null).run(["$ionicPlatform","$timeout","$rootScope",function(e,n,i){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),i.$broadcast("name-changed")})}])}(),function(){"use strict";angular.module("app").run(["$rootScope","$location","authService",function(e,n,i){e.$on("$routeChangeStart",function(e){null==i.user()&&(e.preventDefault(),n.go("login"))})}])}(),function(){"use strict";angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("app",{url:"/app",cache:!1,"abstract":!0,templateUrl:"views/sidemenu.html"}).state("app.buildings",{url:"/buildings",views:{menuContent:{templateUrl:"views/buildings.html"}}}).state("app.building",{url:"/buildings/:buildingId",views:{menuContent:{templateUrl:"views/building.html"}}}).state("app.profile",{url:"/profile",cache:!1,views:{menuContent:{templateUrl:"views/profile/profile.html"}}}).state("app.logout",{url:"/login",templateProvider:["authService","$state",function(e,n){e.logout(),n.go("login")}]}).state("login",{url:"/login",templateUrl:"views/auth/login.html"}),n.otherwise("/login")}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGgvYXV0aC5tb2R1bGUuanMiLCJidWlsZGluZ3MvYnVpbGRpbmdzLm1vZHVsZS5qcyIsImZpcmViYXNlL2ZpcmViYXNlLm1vZHVsZS5qcyIsIm1lc3NhZ2VzL21lc3NhZ2VzLm1vZHVsZS5qcyIsInByb2ZpbGUvcHJvZmlsZXMubW9kdWxlLmpzIiwic2lkZW1lbnUvc2lkZW1lbnUubW9kdWxlLmpzIiwidXNlcnMvdXNlcnMubW9kdWxlLmpzIiwiYXV0aC9hdXRoQ29udHJvbGxlci5qcyIsImFwcC5idW5kbGUuanMiLCJhdXRoL2F1dGhTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nQ29udHJvbGxlci5qcyIsImJ1aWxkaW5ncy9idWlsZGluZ3NDb250cm9sbGVyLmpzIiwiYnVpbGRpbmdzL2J1aWxkaW5nc1NlcnZpY2UuanMiLCJmaXJlYmFzZS9maXJlYmFzZVNlcnZpY2UuanMiLCJtZXNzYWdlcy9tZXNzYWdlc0NvbnRyb2xsZXIuanMiLCJtZXNzYWdlcy9tZXNzYWdlc1NlcnZpY2UuanMiLCJwcm9maWxlL3Byb2ZpbGVDb250cm9sbGVyLmpzIiwicHJvZmlsZS9wcm9maWxlc1NlcnZpY2UuanMiLCJzaWRlbWVudS9zaWRlbWVudUNvbnRyb2xsZXIuanMiLCJ1c2Vycy91c2Vyc1NlcnZpY2UuanMiLCJhcHAubW9kdWxlLmpzIiwiYXBwLnJvdXRlci5maWx0ZXIuanMiLCJhcHAucm91dGVyLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJhdXRoQ29udHJvbGxlciIsIiRzY29wZSIsImF1dGhTZXJ2aWNlIiwiJGlvbmljUG9wdXAiLCIkaW9uaWNMb2FkaW5nIiwiJHN0YXRlIiwiJHRpbWVvdXQiLCJkYXRhIiwibG9naW4iLCJzaG93IiwidXNlcm5hbWUiLCJwYXNzd29yZCIsInN1Y2Nlc3MiLCJ1c2VyIiwiaGlkZSIsImdvIiwiZXJyb3IiLCJhbGVydCIsInRpdGxlIiwidGVtcGxhdGUiLCJtZXNzYWdlIiwiZmFjZWJvb2tMb2dpbiIsIiRpbmplY3QiLCJjb250cm9sbGVyIiwiJHEiLCIkcm9vdFNjb3BlIiwiYnVpbGRpbmdzU2VydmljZSIsInNlbGVjdGVkQnVpbGRpbmciLCJhdXRoIiwiZmlyZWJhc2UiLCIkb24iLCJ1c3IiLCJjdXJyZW50VXNlciIsImRhdGFiYXNlIiwicmVmIiwidWlkIiwic2V0IiwibmFtZSIsImRpc3BsYXlOYW1lIiwiZW1haWwiLCJsYXN0QWN0aXZpdHkiLCJEYXRlIiwiZ2V0VGltZSIsImRlZmVycmVkIiwiZGVmZXIiLCJwcm9taXNlIiwic3VjY2Vzc0hhbmRsZXIiLCJpbmZvIiwiaXNOZXciLCJyZXNvbHZlIiwiJGVtaXQiLCJlcnJvckhhbmRsZXIiLCJyZWplY3QiLCJzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCIsInRoZW4iLCJjb2RlIiwiY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkIiwiZm4iLCJsb2dvdXQiLCJzaWduT3V0Iiwic2VydmljZSIsImJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlIiwiZmlyZWJhc2VTZXJ2aWNlIiwiZ2V0Q2hhbm5lbHNGcm9tIiwiYnVpbGRpbmciLCJmYiIsImJ1aWxkaW5nQ29udHJvbGxlciIsIiRzdGF0ZVBhcmFtcyIsImJ1aWxkaW5nSWQiLCJvbiIsInNuYXBzaG90IiwidmFsIiwiY2hhbm5lbHMiLCJleHRlbmQiLCJjb21tb24iLCJzZXJ2aWNlcyIsImVycm9yT2JqZWN0IiwiY29uc29sZSIsImxvZyIsImJ1aWxkaW5nc0NvbnRyb2xsZXIiLCJnZXRCdWlsZGluZ3MiLCJzZWxlY3RlZEtleSIsImtleSIsInNlbGVjdCIsImJ1aWxkaW5ncyIsImNvbmZpZyIsImFwaUtleSIsImF1dGhEb21haW4iLCJkYXRhYmFzZVVSTCIsInN0b3JhZ2VCdWNrZXQiLCJ0aGlzIiwiaW5pdGlhbGl6ZUFwcCIsIm1lc3NhZ2VzU2VydmljZSIsIm9iaiIsImdldE1lc3NhZ2VzUmVmIiwicHJvZmlsZUNvbnRyb2xsZXIiLCJwcm9maWxlc1NlcnZpY2UiLCJ1cGRhdGUiLCJ1cGRhdGVQcm9maWxlIiwibXNnIiwiJGJyb2FkY2FzdCIsInNpZGVtZW51Q29udHJvbGxlciIsImFkZHJlc3MiLCJldmVudCIsImNoYW5uZWwiLCJjaGFubmVsS2V5IiwidXNlcnNTZXJ2aWNlIiwidmFsdWUiLCJydW4iLCIkaW9uaWNQbGF0Zm9ybSIsInJlYWR5Iiwid2luZG93IiwiY29yZG92YSIsInBsdWdpbnMiLCJLZXlib2FyZCIsImhpZGVLZXlib2FyZEFjY2Vzc29yeUJhciIsImRpc2FibGVTY3JvbGwiLCJTdGF0dXNCYXIiLCJzdHlsZURlZmF1bHQiLCJwcmV2ZW50RGVmYXVsdCIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwic3RhdGUiLCJ1cmwiLCJjYWNoZSIsImFic3RyYWN0IiwidGVtcGxhdGVVcmwiLCJ2aWV3cyIsIm1lbnVDb250ZW50IiwidGVtcGxhdGVQcm92aWRlciIsIm90aGVyd2lzZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQUVBQSxTQUFBQyxPQUFBLGtCQ0hBLFdBQ0EsWUFFQUQsU0FBQUMsT0FBQSxpQkFBQSxvQkNIQSxXQUNBLFlBRUFELFNBQ0FDLE9BQUEsc0JDSkEsV0FDQSxZQUVBRCxTQUNBQyxPQUFBLHFCQ0pBLFdBQ0EsWUFFQUQsU0FBQUMsT0FBQSxnQkFBQSxnQkNIQSxXQUNBLFlBRUFELFNBQUFDLE9BQUEsc0JDSEEsV0FDQSxZQUVBRCxTQUFBQyxPQUFBLGFBQUEsZ0JDSEEsV0FDQSxZQU9BLFNBQUFDLEdBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUFMLEVBQUFNLFFBRUFOLEVBQUFPLE1BQUEsV0FDQUosRUFBQUssT0FFQVAsRUFBQU0sTUFBQVAsRUFBQU0sS0FBQUcsU0FBQVQsRUFBQU0sS0FBQUksVUFBQUMsUUFBQSxTQUFBQyxHQUNBVCxFQUFBVSxPQUNBVCxFQUFBVSxHQUFBLG1CQUVBQyxNQUFBLFNBQUFBLEdBQ0FWLEVBQUEs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LEVBRUFFLE1BQUEsT0FDQUMsSUFBQSxPQUNBQyxPQUFBLEVBQ0FDLFlBQUEsRUFDQUMsWUFBQSx3QkFHQUosTUFBQSxpQkFDQUMsSUFBQSxhQUNBSSxPQUNBQyxhQUNBRixZQUFBLDJCQUtBSixNQUFBLGdCQUNBQyxJQUFBLHlCQUNBSSxPQUNBQyxhQUNBRixZQUFBLDBCQUtBSixNQUFBLGVBQ0FDLElBQUEsV0FDQUMsT0FBQSxFQUNBRyxPQUNBQyxhQUNBRixZQUFBLGlDQUtBSixNQUFBLGNBQ0FDLElBQUEsU0FDQU0sa0JBQUEsY0FBQSxTQUFBLFNBQUEvSCxFQUFBRyxHQUNBSCxFQUFBd0QsU0FDQXJELEVBQUFVLEdBQUEsYUFHQTJHLE1BQUEsU0FDQUMsSUFBQSxTQUNBRyxZQUFBLDBCQUtBTCxFQUFBUyxVQUFBIiwiZmlsZSI6ImFwcC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmF1dGhcIiwgW10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmJ1aWxkaW5nc1wiLCBbJ2FwcC5maXJlYmFzZSddKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmZpcmViYXNlJywgW10pO1xufSkoKTtcblxuXG5cblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5tZXNzYWdlJywgW10pO1xufSkoKTtcblxuXG5cblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiLCBbJ2FwcC5hdXRoJ10pO1xufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnNpZGVtZW51XCIsIFtdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC51c2Vyc1wiLCBbJ2FwcC5hdXRoJ10pO1xufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwiYXV0aENvbnRyb2xsZXJcIiwgYXV0aENvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBhdXRoQ29udHJvbGxlcigkc2NvcGUsIGF1dGhTZXJ2aWNlLCAkaW9uaWNQb3B1cCwgJGlvbmljTG9hZGluZywgJHN0YXRlLCAkdGltZW91dCkge1xuXG4gICAgICAgICRzY29wZS5kYXRhID0ge307XG5cbiAgICAgICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24oKSB7XG5cdFx0XHQkaW9uaWNMb2FkaW5nLnNob3coKTtcblxuXHRcdFx0YXV0aFNlcnZpY2UubG9naW4oJHNjb3BlLmRhdGEudXNlcm5hbWUsICRzY29wZS5kYXRhLnBhc3N3b3JkKS5zdWNjZXNzKGZ1bmN0aW9uKHVzZXIpIHtcblx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cdFx0XHRcdCRzdGF0ZS5nbygnYXBwLmJ1aWxkaW5ncycpO1xuXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihlcnJvcikge1xuXHRcdFx0XHQkdGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblx0XHRcdFx0fSwgMTAwKTtcblxuICAgICAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0xvZ2luIGZhaWxlZCEnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZXJyb3IubWVzc2FnZSAvLydQbGVhc2UgY2hlY2sgeW91ciBjcmVkZW50aWFscyEnXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG5cdFx0JHNjb3BlLmZhY2Vib29rTG9naW4gPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuXHRcdFx0XHR0aXRsZTogJ0ZhY2Vib29rIGxvZ2luJyxcblx0XHRcdFx0dGVtcGxhdGU6ICdQbGFubmVkISdcblx0XHRcdH0pO1xuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmF1dGhcIiwgW10pO1xufSkoKTtcbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIsIFsnYXBwLmZpcmViYXNlJ10pO1xufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5maXJlYmFzZScsIFtdKTtcbn0pKCk7XG5cblxuXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5tZXNzYWdlJywgW10pO1xufSkoKTtcblxuXG5cblxuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIsIFsnYXBwLmF1dGgnXSk7XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5zaWRlbWVudVwiLCBbXSk7XG59KSgpO1xuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC51c2Vyc1wiLCBbJ2FwcC5hdXRoJ10pO1xufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhdXRoQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCIkaW9uaWNQb3B1cFwiLCBcIiRpb25pY0xvYWRpbmdcIiwgXCIkc3RhdGVcIiwgXCIkdGltZW91dFwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5hdXRoXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJhdXRoQ29udHJvbGxlclwiLCBhdXRoQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGF1dGhDb250cm9sbGVyKCRzY29wZSwgYXV0aFNlcnZpY2UsICRpb25pY1BvcHVwLCAkaW9uaWNMb2FkaW5nLCAkc3RhdGUsICR0aW1lb3V0KSB7XG5cbiAgICAgICAgJHNjb3BlLmRhdGEgPSB7fTtcblxuICAgICAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbigpIHtcblx0XHRcdCRpb25pY0xvYWRpbmcuc2hvdygpO1xuXG5cdFx0XHRhdXRoU2VydmljZS5sb2dpbigkc2NvcGUuZGF0YS51c2VybmFtZSwgJHNjb3BlLmRhdGEucGFzc3dvcmQpLnN1Y2Nlc3MoZnVuY3Rpb24odXNlcikge1xuXHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblx0XHRcdFx0JHN0YXRlLmdvKCdhcHAuYnVpbGRpbmdzJyk7XG5cbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHRcdCR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCRpb25pY0xvYWRpbmcuaGlkZSgpO1xuXHRcdFx0XHR9LCAxMDApO1xuXG4gICAgICAgICAgICAgICAgdmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTG9naW4gZmFpbGVkIScsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBlcnJvci5tZXNzYWdlIC8vJ1BsZWFzZSBjaGVjayB5b3VyIGNyZWRlbnRpYWxzISdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cblx0XHQkc2NvcGUuZmFjZWJvb2tMb2dpbiA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGFsZXJ0UG9wdXAgPSAkaW9uaWNQb3B1cC5hbGVydCh7XG5cdFx0XHRcdHRpdGxlOiAnRmFjZWJvb2sgbG9naW4nLFxuXHRcdFx0XHR0ZW1wbGF0ZTogJ1BsYW5uZWQhJ1xuXHRcdFx0fSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGF1dGhTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCJ1c2VyXCIsIFwiYnVpbGRpbmdzU2VydmljZVwiLCBcInNlbGVjdGVkQnVpbGRpbmdcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYXV0aFwiKVxuXG4gICAgICAgIC5zZXJ2aWNlKFwiYXV0aFNlcnZpY2VcIiwgYXV0aFNlcnZpY2UpO1xuXG5cdGZ1bmN0aW9uIGNyZWF0ZVVzZXIodXNlcm5hbWUsIHBhc3N3b3JkKSB7XG5cdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblx0XHR2YXIgYXV0aCA9IGZpcmViYXNlU2VydmljZS5mYi5hdXRoKCk7XG5cblx0XHRyZXR1cm4gYXV0aC5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQoZW1haWwsIHBhc3N3b3JkKTtcblx0fVxuXHRcbiAgICBmdW5jdGlvbiBhdXRoU2VydmljZSgkcSwgJHJvb3RTY29wZSwgdXNlciwgYnVpbGRpbmdzU2VydmljZSwgc2VsZWN0ZWRCdWlsZGluZykge1xuXHRcdHZhciBhdXRoID0gZmlyZWJhc2UuYXV0aCgpO1xuXHRcdFxuXHRcdCRyb290U2NvcGUuJG9uKCduYW1lLWNoYW5nZWQnLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB1c3IgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7XG5cdFx0XHRpZiAodXNyID09IG51bGwpIHJldHVybjtcblx0XHRcdFxuXHRcdFx0ZmlyZWJhc2UuZGF0YWJhc2UoKS5yZWYoJ3VzZXJzLycgKyB1c3IudWlkKS5zZXQoe1xuXHRcdFx0XHRuYW1lOiB1c3IuZGlzcGxheU5hbWUsXG5cdFx0XHRcdGVtYWlsOiB1c3IuZW1haWwsXG5cdFx0XHRcdGxhc3RBY3Rpdml0eTogbmV3IERhdGUoKS5nZXRUaW1lKClcblx0XHRcdH0pO1xuXHRcdH0pO1xuXG5cdFx0cmV0dXJuIHtcbiAgICAgICAgICAgIGxvZ2luOiBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gZGVmZXJyZWQucHJvbWlzZTtcblxuXHRcdFx0XHR2YXIgc3VjY2Vzc0hhbmRsZXIgPSBmdW5jdGlvbihpbmZvKSB7XG5cdFx0XHRcdFx0aW5mby5pc05ldyA9IGluZm8uZGlzcGxheU5hbWUgPT0gbnVsbDtcblx0XHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKGluZm8pO1xuXHRcdFx0XHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0dXNlciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcblx0XHRcdFx0XHQkcm9vdFNjb3BlLiRlbWl0KCduYW1lLWNoYW5nZWQnKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHR2YXIgZXJyb3JIYW5kbGVyID0gZnVuY3Rpb24oZXJyb3IpIHtcblx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGF1dGguc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHRcdC50aGVuKHN1Y2Nlc3NIYW5kbGVyLCBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xuXHRcdFx0XHRcdFx0aWYgKGVycm9yLmNvZGUgPT0gXCJhdXRoL3VzZXItbm90LWZvdW5kXCIpIHtcblx0XHRcdFx0XHRcdFx0YXV0aC5jcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQodXNlcm5hbWUsIHBhc3N3b3JkKVxuXHRcdFx0XHRcdFx0XHRcdC50aGVuKHN1Y2Nlc3NIYW5kbGVyLCBlcnJvckhhbmRsZXIpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGVycm9ySGFuZGxlcihlcnJvcik7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cbiAgICAgICAgICAgICAgICBwcm9taXNlLnN1Y2Nlc3MgPSBmdW5jdGlvbihmbikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4oZm4pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcHJvbWlzZS5lcnJvciA9IGZ1bmN0aW9uKGZuKSB7XG4gICAgICAgICAgICAgICAgICAgIHByb21pc2UudGhlbihudWxsLCBmbik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG5cblx0XHRcdGxvZ291dDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRhdXRoLnNpZ25PdXQoKTtcblx0XHRcdFx0dXNlciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcblx0XHRcdH0sXG5cbiAgICAgICAgICAgIHVzZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRyZXR1cm4gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBidWlsZGluZ0NoYW5uZWxzU2VydmljZS4kaW5qZWN0ID0gW1wiZmlyZWJhc2VTZXJ2aWNlXCJdO1xuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmJ1aWxkaW5ncycpXG4gICAgICAgIC5zZXJ2aWNlKCdidWlsZGluZ0NoYW5uZWxzU2VydmljZScsIGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlKTtcblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlKGZpcmViYXNlU2VydmljZSkge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRDaGFubmVsc0Zyb206IGZ1bmN0aW9uIChidWlsZGluZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJlYmFzZVNlcnZpY2UuZmIuZGF0YWJhc2UoKS5yZWYoJ2J1aWxkaW5ncy8nICsgYnVpbGRpbmcgKyBcIi9jaGFubmVsc1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBidWlsZGluZ0NvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRpb25pY0xvYWRpbmdcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCJidWlsZGluZ0NoYW5uZWxzU2VydmljZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nQ29udHJvbGxlclwiLCBidWlsZGluZ0NvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCAkc3RhdGVQYXJhbXMsIGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlKSB7XG5cbiAgICAgICAgdmFyIHJlZiA9IGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlLmdldENoYW5uZWxzRnJvbSgkc3RhdGVQYXJhbXMuYnVpbGRpbmdJZCk7XG5cbiAgICAgICAgJGlvbmljTG9hZGluZy5zaG93KCk7XG4gICAgICAgIHJlZi5vbihcInZhbHVlXCIsIGZ1bmN0aW9uIChzbmFwc2hvdCkge1xuICAgICAgICAgICAgdmFyIHZhbCA9IHNuYXBzaG90LnZhbCgpO1xuXG4gICAgICAgICAgICBpZiAodmFsKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmNoYW5uZWxzID0gYW5ndWxhci5leHRlbmQodmFsLmNvbW1vbiwgdmFsLnNlcnZpY2VzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZC4nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9KTtcblxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGJ1aWxkaW5nc0NvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRpb25pY0xvYWRpbmdcIiwgXCJidWlsZGluZ3NTZXJ2aWNlXCIsIFwic2VsZWN0ZWRCdWlsZGluZ1wiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5idWlsZGluZ3NcIilcblxuICAgICAgICAuY29udHJvbGxlcihcImJ1aWxkaW5nc0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdzQ29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc0NvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCBidWlsZGluZ3NTZXJ2aWNlLCBzZWxlY3RlZEJ1aWxkaW5nKSB7XG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ3NTZXJ2aWNlLmdldEJ1aWxkaW5ncygpO1xuXHRcdFxuXHRcdCRzY29wZS5zZWxlY3RlZEtleSA9IHNlbGVjdGVkQnVpbGRpbmcgPyBzZWxlY3RlZEJ1aWxkaW5nLmtleSA6IG51bGw7XG5cdFx0XG5cdFx0JHNjb3BlLnNlbGVjdCA9IGZ1bmN0aW9uKGtleSwgYnVpbGRpbmcpIHtcblx0XHRcdCRzY29wZS5zZWxlY3RlZEtleSA9IGJ1aWxkaW5nLmtleSA9IGtleTtcblx0XHRcdHNlbGVjdGVkQnVpbGRpbmcgPSBidWlsZGluZztcblx0XHRcdCRzY29wZS4kZW1pdChcImJ1aWxkaW5nLXNlbGVjdGVkXCIsIHNlbGVjdGVkQnVpbGRpbmcpO1xuXHRcdH07XHRcdFxuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgICRzY29wZS5idWlsZGluZ3MgPSBzbmFwc2hvdC52YWwoKTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3JPYmplY3QpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgcmVhZGluZzogXCIgKyBlcnJvck9iamVjdC5jb2RlKTtcbiAgICAgICAgICAgIHZhciBhbGVydFBvcHVwID0gJGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnT3BzIScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6ICdTb3JyeSEgQW4gZXJyb3Igb2N1cnJlZCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGJ1aWxkaW5nc1NlcnZpY2UuJGluamVjdCA9IFtcImZpcmViYXNlU2VydmljZVwiLCBcIiRyb290U2NvcGVcIl07XG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuYnVpbGRpbmdzJylcbiAgICAgICAgLnNlcnZpY2UoJ2J1aWxkaW5nc1NlcnZpY2UnLCBidWlsZGluZ3NTZXJ2aWNlKTtcblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc1NlcnZpY2UoZmlyZWJhc2VTZXJ2aWNlLCAkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldEJ1aWxkaW5nczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuZmlyZWJhc2UnKVxuICAgICAgICAuc2VydmljZSgnZmlyZWJhc2VTZXJ2aWNlJywgZmlyZWJhc2VTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gZmlyZWJhc2VTZXJ2aWNlKCkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5OiBcIkFJemFTeUI1cTgxQUdHb3g0aTgtUUwyS090bkREZmkwNWlyZ2NIRVwiLFxuICAgICAgICAgICAgYXV0aERvbWFpbjogXCJzb2NpYWxzdHJhdGFpZGVhdGVhbS5maXJlYmFzZWFwcC5jb21cIixcbiAgICAgICAgICAgIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vc29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2Vpby5jb21cIixcbiAgICAgICAgICAgIHN0b3JhZ2VCdWNrZXQ6IFwiXCIsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5mYiA9IGZpcmViYXNlLmluaXRpYWxpemVBcHAoY29uZmlnKTtcbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLm1lc3NhZ2UnKTtcbn0pKCk7XG5cblxuXG5cblxuKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5tZXNzYWdlJylcbiAgICAgICAgLnNlcnZpY2UoJ21lc3NhZ2VzU2VydmljZScsIG1lc3NhZ2VzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBtZXNzYWdlc1NlcnZpY2UoKSB7XG5cdFx0dmFyIG9iaiA9IHt9O1xuXHRcdFxuXHRcdG9iai5nZXRNZXNzYWdlc1JlZiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignbWVzc2FnZXMnKTtcblx0XHR9O1xuXHRcdFxuXHRcdG9iai5nZXRNZXNzYWdlc1JlZiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignbWVzc2FnZXMnKTtcblx0XHR9O1xuXHRcdFxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cbn0pKCk7XG5cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBwcm9maWxlQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGlvbmljTG9hZGluZ1wiLCBcIiRpb25pY1BvcHVwXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCJwcm9maWxlc1NlcnZpY2VcIl07XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInByb2ZpbGVDb250cm9sbGVyXCIsIHByb2ZpbGVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvZmlsZUNvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCAkaW9uaWNQb3B1cCwgYXV0aFNlcnZpY2UsIHByb2ZpbGVzU2VydmljZSkge1xuXG5cdFx0dmFyIHVzZXIgPSBhdXRoU2VydmljZS51c2VyKCk7XG5cdFx0XG5cdFx0JHNjb3BlLmRhdGEgPSB7XG5cdFx0XHRkaXNwbGF5TmFtZSA6IHVzZXIgPyB1c2VyLmRpc3BsYXlOYW1lIDogXCJcIixcblx0XHRcdGVtYWlsIDogdXNlciA/IHVzZXIuZW1haWwgOiBcIlwiXG5cdFx0fTtcblxuICAgICAgICAkc2NvcGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHQkaW9uaWNMb2FkaW5nLnNob3coKTtcblxuICAgICAgICAgICAgcHJvZmlsZXNTZXJ2aWNlLnVwZGF0ZVByb2ZpbGUoJHNjb3BlLmRhdGEpLnRoZW4oZnVuY3Rpb24gc3VjY2Vzcyhtc2cpIHtcblx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cblx0XHRcdFx0JGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Byb2ZpbGVVcGRhdGUhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IG1zZ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xuXHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblxuXHRcdFx0XHQkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXBkYXRlIGZhaWxlZCEnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpO1xuKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHByb2ZpbGVzU2VydmljZS4kaW5qZWN0ID0gW1wiJHFcIiwgXCIkcm9vdFNjb3BlXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCJ1c2VyXCJdO1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnByb2ZpbGVzXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJwcm9maWxlc1NlcnZpY2VcIiwgcHJvZmlsZXNTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvZmlsZXNTZXJ2aWNlKCRxLCAkcm9vdFNjb3BlLCBhdXRoU2VydmljZSwgdXNlcikge1xuXHRcdFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlUHJvZmlsZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS51c2VyKCkudXBkYXRlUHJvZmlsZShkYXRhKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShcIlByb2ZpbGUgdXBkYXRlZCFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxufSkoKTtcbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBzaWRlbWVudUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiXTtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5zaWRlbWVudVwiKVxuXG4gICAgICAgIC5jb250cm9sbGVyKFwic2lkZW1lbnVDb250cm9sbGVyXCIsIHNpZGVtZW51Q29udHJvbGxlcik7XG5cblxuICAgIGZ1bmN0aW9uIHNpZGVtZW51Q29udHJvbGxlcigkc2NvcGUsICRzdGF0ZSkge1xuXHRcdC8vICRzY29wZS4kb24oJ25hbWUtY2hhbmdlZCcsIGZ1bmN0aW9uKCkge1xuXHRcdC8vIFx0JHNjb3BlLmRpc3BsYXlOYW1lID0gYXV0aFNlcnZpY2UudXNlcigpLmRpc3BsYXlOYW1lO1xuXHRcdC8vIH0pO1xuXHRcdFxuXHRcdCRzY29wZS5idWlsZGluZyA9IHtcblx0XHRcdG5hbWU6IFwiU2VsZWN0IGEgYnVpbGRpbmdcIixcblx0XHRcdGFkZHJlc3M6IFwiXCIsXG5cdFx0fTtcblx0XHRcblx0XHQkc2NvcGUuJG9uKCdidWlsZGluZy1zZWxlY3RlZCcsIGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XG5cdFx0XHQkc2NvcGUuYnVpbGRpbmcubmFtZSA9IGRhdGEubmFtZTtcblx0XHRcdCRzY29wZS5idWlsZGluZy5hZGRyZXNzID0gZGF0YS5hZGRyZXNzO1xuXHRcdH0pO1xuXHRcdFxuXHRcdCRzY29wZS5jaGFubmVsID0gZnVuY3Rpb24oY2hhbm5lbEtleSkge1xuXHRcdFx0Ly8kc3RhdGUuZ28oJ2FwcC5jaGFubmVsJywgeyBidWlsZGluZ0lkOiBjaGFubmVsS2V5fSk7XG5cdFx0fTtcbiAgICB9XG59KSgpO1xuXG4oZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdXNlcnNTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcVwiLCBcImF1dGhTZXJ2aWNlXCJdO1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnVzZXJzXCIpXG5cbiAgICAgICAgLnNlcnZpY2UoXCJ1c2Vyc1NlcnZpY2VcIiwgdXNlcnNTZXJ2aWNlKTtcblxuXG4gICAgZnVuY3Rpb24gdXNlcnNTZXJ2aWNlKCRxLCBhdXRoU2VydmljZSkge1xuXHQgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVwZGF0ZVByb2ZpbGU6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UudXNlcigpLnVwZGF0ZVByb2ZpbGUoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gc3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoXCJQcm9maWxlIHVwZGF0ZWQhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmFtZS1jaGFuZ2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnLCBbXG4gICAgICAgICAgICAnaW9uaWMnLFxuXHRcdFx0XG5cdFx0XHQnYXBwLmZpcmViYXNlJyxcbiAgICAgICAgICAgICdhcHAuYXV0aCcsXG4gICAgICAgICAgICAnYXBwLm1lc3NhZ2UnLFxuXHRcdFx0J2FwcC5zaWRlbWVudScsXG4gICAgICAgICAgICAnYXBwLmJ1aWxkaW5ncycsXG4gICAgICAgICAgICAnYXBwLnByb2ZpbGVzJ1xuICAgICAgICBdKVxuXHRcdFxuXHRcdC52YWx1ZShcInVzZXJcIiwgbnVsbClcblx0XHQudmFsdWUoXCJzZWxlY3RlZEJ1aWxkaW5nXCIsIG51bGwpXG5cbiAgICAgICAgLnJ1bihbXCIkaW9uaWNQbGF0Zm9ybVwiLCBcIiR0aW1lb3V0XCIsIFwiJHJvb3RTY29wZVwiLCBmdW5jdGlvbiAoJGlvbmljUGxhdGZvcm0sICR0aW1lb3V0LCAkcm9vdFNjb3BlKSB7XG5cdFx0XHQkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuZGlzYWJsZVNjcm9sbCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5TdGF0dXNCYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgU3RhdHVzQmFyLnN0eWxlRGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblx0XHRcdFx0XG5cdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmFtZS1jaGFuZ2VkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pO1xufSkoKTtcblxuXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG5cbiAgICAgICAgLnJ1bihbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzdGF0ZSwgYXV0aFNlcnZpY2UpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLnVzZXIoKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuXHRcdFxuICAgICAgICAuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgICAgICAgICAgICRzdGF0ZVByb3ZpZGVyXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwcCcsXG5cdFx0XHRcdFx0Y2FjaGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9zaWRlbWVudS5odG1sJyxcbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAuYnVpbGRpbmdzJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYnVpbGRpbmdzJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2J1aWxkaW5ncy5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLmJ1aWxkaW5nJywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvYnVpbGRpbmdzLzpidWlsZGluZ0lkJyxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3ZpZXdzL2J1aWxkaW5nLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAucHJvZmlsZScsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL3Byb2ZpbGUnLFxuXHRcdFx0XHRcdGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdmlld3M6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdtZW51Q29udGVudCc6IHtcblx0XHRcdFx0XHRcdFx0dGVtcGxhdGVVcmw6ICd2aWV3cy9wcm9maWxlL3Byb2ZpbGUuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cblx0XHRcdFx0LnN0YXRlKCdhcHAubG9nb3V0Jywge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2xvZ2luXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlUHJvdmlkZXI6IFtcImF1dGhTZXJ2aWNlXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChhdXRoU2VydmljZSwgJHN0YXRlKSB7XG5cdFx0XHRcdFx0XHRhdXRoU2VydmljZS5sb2dvdXQoKTtcblx0XHRcdFx0XHRcdCRzdGF0ZS5nbygnbG9naW4nKTtcblx0XHRcdFx0XHR9XVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9sb2dpblwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9hdXRoL2xvZ2luLmh0bWxcIlxuICAgICAgICAgICAgICAgIH0pO1xuXHRcdFx0XHRcblxuICAgICAgICAgICAgLy9mYWxsYmFja1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XG5cbiAgICAgICAgfV0pO1xufSkoKTtcblxuXG5cblxuIiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLmF1dGhcIilcblxuICAgICAgICAuc2VydmljZShcImF1dGhTZXJ2aWNlXCIsIGF1dGhTZXJ2aWNlKTtcblxuXHRmdW5jdGlvbiBjcmVhdGVVc2VyKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuXHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cdFx0dmFyIGF1dGggPSBmaXJlYmFzZVNlcnZpY2UuZmIuYXV0aCgpO1xuXG5cdFx0cmV0dXJuIGF1dGguY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKGVtYWlsLCBwYXNzd29yZCk7XG5cdH1cblx0XG4gICAgZnVuY3Rpb24gYXV0aFNlcnZpY2UoJHEsICRyb290U2NvcGUsIHVzZXIsIGJ1aWxkaW5nc1NlcnZpY2UsIHNlbGVjdGVkQnVpbGRpbmcpIHtcblx0XHR2YXIgYXV0aCA9IGZpcmViYXNlLmF1dGgoKTtcblx0XHRcblx0XHQkcm9vdFNjb3BlLiRvbignbmFtZS1jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdXNyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuXHRcdFx0aWYgKHVzciA9PSBudWxsKSByZXR1cm47XG5cdFx0XHRcblx0XHRcdGZpcmViYXNlLmRhdGFiYXNlKCkucmVmKCd1c2Vycy8nICsgdXNyLnVpZCkuc2V0KHtcblx0XHRcdFx0bmFtZTogdXNyLmRpc3BsYXlOYW1lLFxuXHRcdFx0XHRlbWFpbDogdXNyLmVtYWlsLFxuXHRcdFx0XHRsYXN0QWN0aXZpdHk6IG5ldyBEYXRlKCkuZ2V0VGltZSgpXG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdHJldHVybiB7XG4gICAgICAgICAgICBsb2dpbjogZnVuY3Rpb24odXNlcm5hbWUsIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IGRlZmVycmVkLnByb21pc2U7XG5cblx0XHRcdFx0dmFyIHN1Y2Nlc3NIYW5kbGVyID0gZnVuY3Rpb24oaW5mbykge1xuXHRcdFx0XHRcdGluZm8uaXNOZXcgPSBpbmZvLmRpc3BsYXlOYW1lID09IG51bGw7XG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShpbmZvKTtcblx0XHRcdFx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdHVzZXIgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7XG5cdFx0XHRcdFx0JHJvb3RTY29wZS4kZW1pdCgnbmFtZS1jaGFuZ2VkJyk7XG5cdFx0XHRcdH07XG5cblx0XHRcdFx0dmFyIGVycm9ySGFuZGxlciA9IGZ1bmN0aW9uKGVycm9yKSB7XG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KGVycm9yKTtcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRhdXRoLnNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0XHQudGhlbihzdWNjZXNzSGFuZGxlciwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcblx0XHRcdFx0XHRcdGlmIChlcnJvci5jb2RlID09IFwiYXV0aC91c2VyLW5vdC1mb3VuZFwiKSB7XG5cdFx0XHRcdFx0XHRcdGF1dGguY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKHVzZXJuYW1lLCBwYXNzd29yZClcblx0XHRcdFx0XHRcdFx0XHQudGhlbihzdWNjZXNzSGFuZGxlciwgZXJyb3JIYW5kbGVyKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlcnJvckhhbmRsZXIoZXJyb3IpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0pO1xuXG4gICAgICAgICAgICAgICAgcHJvbWlzZS5zdWNjZXNzID0gZnVuY3Rpb24oZm4pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvbWlzZS50aGVuKGZuKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByb21pc2UuZXJyb3IgPSBmdW5jdGlvbihmbikge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlLnRoZW4obnVsbCwgZm4pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICB9LFxuXG5cdFx0XHRsb2dvdXQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0YXV0aC5zaWduT3V0KCk7XG5cdFx0XHRcdHVzZXIgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXI7XG5cdFx0XHR9LFxuXG4gICAgICAgICAgICB1c2VyOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmJ1aWxkaW5ncycpXG4gICAgICAgIC5zZXJ2aWNlKCdidWlsZGluZ0NoYW5uZWxzU2VydmljZScsIGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlKTtcblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nQ2hhbm5lbHNTZXJ2aWNlKGZpcmViYXNlU2VydmljZSkge1xuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBnZXRDaGFubmVsc0Zyb206IGZ1bmN0aW9uIChidWlsZGluZykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJlYmFzZVNlcnZpY2UuZmIuZGF0YWJhc2UoKS5yZWYoJ2J1aWxkaW5ncy8nICsgYnVpbGRpbmcgKyBcIi9jaGFubmVsc1wiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5cbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJidWlsZGluZ0NvbnRyb2xsZXJcIiwgYnVpbGRpbmdDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gYnVpbGRpbmdDb250cm9sbGVyKCRzY29wZSwgJGlvbmljTG9hZGluZywgJHN0YXRlUGFyYW1zLCBidWlsZGluZ0NoYW5uZWxzU2VydmljZSkge1xuXG4gICAgICAgIHZhciByZWYgPSBidWlsZGluZ0NoYW5uZWxzU2VydmljZS5nZXRDaGFubmVsc0Zyb20oJHN0YXRlUGFyYW1zLmJ1aWxkaW5nSWQpO1xuXG4gICAgICAgICRpb25pY0xvYWRpbmcuc2hvdygpO1xuICAgICAgICByZWYub24oXCJ2YWx1ZVwiLCBmdW5jdGlvbiAoc25hcHNob3QpIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSBzbmFwc2hvdC52YWwoKTtcblxuICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5jaGFubmVscyA9IGFuZ3VsYXIuZXh0ZW5kKHZhbC5jb21tb24sIHZhbC5zZXJ2aWNlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGlvbmljTG9hZGluZy5oaWRlKCk7XG5cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yT2JqZWN0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHJlYWRpbmc6IFwiICsgZXJyb3JPYmplY3QuY29kZSk7XG4gICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ09wcyEnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnU29ycnkhIEFuIGVycm9yIG9jdXJyZWQuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAuYnVpbGRpbmdzXCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJidWlsZGluZ3NDb250cm9sbGVyXCIsIGJ1aWxkaW5nc0NvbnRyb2xsZXIpO1xuXG5cbiAgICBmdW5jdGlvbiBidWlsZGluZ3NDb250cm9sbGVyKCRzY29wZSwgJGlvbmljTG9hZGluZywgYnVpbGRpbmdzU2VydmljZSwgc2VsZWN0ZWRCdWlsZGluZykge1xuICAgICAgICB2YXIgcmVmID0gYnVpbGRpbmdzU2VydmljZS5nZXRCdWlsZGluZ3MoKTtcblx0XHRcblx0XHQkc2NvcGUuc2VsZWN0ZWRLZXkgPSBzZWxlY3RlZEJ1aWxkaW5nID8gc2VsZWN0ZWRCdWlsZGluZy5rZXkgOiBudWxsO1xuXHRcdFxuXHRcdCRzY29wZS5zZWxlY3QgPSBmdW5jdGlvbihrZXksIGJ1aWxkaW5nKSB7XG5cdFx0XHQkc2NvcGUuc2VsZWN0ZWRLZXkgPSBidWlsZGluZy5rZXkgPSBrZXk7XG5cdFx0XHRzZWxlY3RlZEJ1aWxkaW5nID0gYnVpbGRpbmc7XG5cdFx0XHQkc2NvcGUuJGVtaXQoXCJidWlsZGluZy1zZWxlY3RlZFwiLCBzZWxlY3RlZEJ1aWxkaW5nKTtcblx0XHR9O1x0XHRcblxuICAgICAgICAkaW9uaWNMb2FkaW5nLnNob3coKTtcbiAgICAgICAgcmVmLm9uKFwidmFsdWVcIiwgZnVuY3Rpb24gKHNuYXBzaG90KSB7XG4gICAgICAgICAgICAkc2NvcGUuYnVpbGRpbmdzID0gc25hcHNob3QudmFsKCk7XG4gICAgICAgICAgICAkaW9uaWNMb2FkaW5nLmhpZGUoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yT2JqZWN0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImVycm9yIHJlYWRpbmc6IFwiICsgZXJyb3JPYmplY3QuY29kZSk7XG4gICAgICAgICAgICB2YXIgYWxlcnRQb3B1cCA9ICRpb25pY1BvcHVwLmFsZXJ0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ09wcyEnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiAnU29ycnkhIEFuIGVycm9yIG9jdXJyZWQnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICRpb25pY0xvYWRpbmcuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAuYnVpbGRpbmdzJylcbiAgICAgICAgLnNlcnZpY2UoJ2J1aWxkaW5nc1NlcnZpY2UnLCBidWlsZGluZ3NTZXJ2aWNlKTtcblxuICAgIGZ1bmN0aW9uIGJ1aWxkaW5nc1NlcnZpY2UoZmlyZWJhc2VTZXJ2aWNlLCAkcm9vdFNjb3BlKSB7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdldEJ1aWxkaW5nczogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignYnVpbGRpbmdzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgnYXBwLmZpcmViYXNlJylcbiAgICAgICAgLnNlcnZpY2UoJ2ZpcmViYXNlU2VydmljZScsIGZpcmViYXNlU2VydmljZSk7XG5cblxuICAgIGZ1bmN0aW9uIGZpcmViYXNlU2VydmljZSgpIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgIGFwaUtleTogXCJBSXphU3lCNXE4MUFHR294NGk4LVFMMktPdG5ERGZpMDVpcmdjSEVcIixcbiAgICAgICAgICAgIGF1dGhEb21haW46IFwic29jaWFsc3RyYXRhaWRlYXRlYW0uZmlyZWJhc2VhcHAuY29tXCIsXG4gICAgICAgICAgICBkYXRhYmFzZVVSTDogXCJodHRwczovL3NvY2lhbHN0cmF0YWlkZWF0ZWFtLmZpcmViYXNlaW8uY29tXCIsXG4gICAgICAgICAgICBzdG9yYWdlQnVja2V0OiBcIlwiLFxuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuZmIgPSBmaXJlYmFzZS5pbml0aWFsaXplQXBwKGNvbmZpZyk7XG4gICAgfVxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAubWVzc2FnZScpO1xufSkoKTtcblxuXG5cblxuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ2FwcC5tZXNzYWdlJylcbiAgICAgICAgLnNlcnZpY2UoJ21lc3NhZ2VzU2VydmljZScsIG1lc3NhZ2VzU2VydmljZSk7XG5cbiAgICBmdW5jdGlvbiBtZXNzYWdlc1NlcnZpY2UoKSB7XG5cdFx0dmFyIG9iaiA9IHt9O1xuXHRcdFxuXHRcdG9iai5nZXRNZXNzYWdlc1JlZiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignbWVzc2FnZXMnKTtcblx0XHR9O1xuXHRcdFxuXHRcdG9iai5nZXRNZXNzYWdlc1JlZiA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZSgpLnJlZignbWVzc2FnZXMnKTtcblx0XHR9O1xuXHRcdFxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAucHJvZmlsZXNcIilcblxuICAgICAgICAuY29udHJvbGxlcihcInByb2ZpbGVDb250cm9sbGVyXCIsIHByb2ZpbGVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gcHJvZmlsZUNvbnRyb2xsZXIoJHNjb3BlLCAkaW9uaWNMb2FkaW5nLCAkaW9uaWNQb3B1cCwgYXV0aFNlcnZpY2UsIHByb2ZpbGVzU2VydmljZSkge1xuXG5cdFx0dmFyIHVzZXIgPSBhdXRoU2VydmljZS51c2VyKCk7XG5cdFx0XG5cdFx0JHNjb3BlLmRhdGEgPSB7XG5cdFx0XHRkaXNwbGF5TmFtZSA6IHVzZXIgPyB1c2VyLmRpc3BsYXlOYW1lIDogXCJcIixcblx0XHRcdGVtYWlsIDogdXNlciA/IHVzZXIuZW1haWwgOiBcIlwiXG5cdFx0fTtcblxuICAgICAgICAkc2NvcGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHQkaW9uaWNMb2FkaW5nLnNob3coKTtcblxuICAgICAgICAgICAgcHJvZmlsZXNTZXJ2aWNlLnVwZGF0ZVByb2ZpbGUoJHNjb3BlLmRhdGEpLnRoZW4oZnVuY3Rpb24gc3VjY2Vzcyhtc2cpIHtcblx0XHRcdFx0JGlvbmljTG9hZGluZy5oaWRlKCk7XG5cblx0XHRcdFx0JGlvbmljUG9wdXAuYWxlcnQoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1Byb2ZpbGVVcGRhdGUhJyxcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6IG1zZ1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihlcnJvcikge1xuXHRcdFx0XHQkaW9uaWNMb2FkaW5nLmhpZGUoKTtcblxuXHRcdFx0XHQkaW9uaWNQb3B1cC5hbGVydCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVXBkYXRlIGZhaWxlZCEnLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcC5wcm9maWxlc1wiKVxuXG4gICAgICAgIC5zZXJ2aWNlKFwicHJvZmlsZXNTZXJ2aWNlXCIsIHByb2ZpbGVzU2VydmljZSk7XG5cblxuICAgIGZ1bmN0aW9uIHByb2ZpbGVzU2VydmljZSgkcSwgJHJvb3RTY29wZSwgYXV0aFNlcnZpY2UsIHVzZXIpIHtcblx0XHRcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVwZGF0ZVByb2ZpbGU6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UudXNlcigpLnVwZGF0ZVByb2ZpbGUoZGF0YSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gc3VjY2VzcygpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoXCJQcm9maWxlIHVwZGF0ZWQhXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmFtZS1jaGFuZ2VkJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwLnNpZGVtZW51XCIpXG5cbiAgICAgICAgLmNvbnRyb2xsZXIoXCJzaWRlbWVudUNvbnRyb2xsZXJcIiwgc2lkZW1lbnVDb250cm9sbGVyKTtcblxuXG4gICAgZnVuY3Rpb24gc2lkZW1lbnVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlKSB7XG5cdFx0Ly8gJHNjb3BlLiRvbignbmFtZS1jaGFuZ2VkJywgZnVuY3Rpb24oKSB7XG5cdFx0Ly8gXHQkc2NvcGUuZGlzcGxheU5hbWUgPSBhdXRoU2VydmljZS51c2VyKCkuZGlzcGxheU5hbWU7XG5cdFx0Ly8gfSk7XG5cdFx0XG5cdFx0JHNjb3BlLmJ1aWxkaW5nID0ge1xuXHRcdFx0bmFtZTogXCJTZWxlY3QgYSBidWlsZGluZ1wiLFxuXHRcdFx0YWRkcmVzczogXCJcIixcblx0XHR9O1xuXHRcdFxuXHRcdCRzY29wZS4kb24oJ2J1aWxkaW5nLXNlbGVjdGVkJywgZnVuY3Rpb24oZXZlbnQsIGRhdGEpIHtcblx0XHRcdCRzY29wZS5idWlsZGluZy5uYW1lID0gZGF0YS5uYW1lO1xuXHRcdFx0JHNjb3BlLmJ1aWxkaW5nLmFkZHJlc3MgPSBkYXRhLmFkZHJlc3M7XG5cdFx0fSk7XG5cdFx0XG5cdFx0JHNjb3BlLmNoYW5uZWwgPSBmdW5jdGlvbihjaGFubmVsS2V5KSB7XG5cdFx0XHQvLyRzdGF0ZS5nbygnYXBwLmNoYW5uZWwnLCB7IGJ1aWxkaW5nSWQ6IGNoYW5uZWxLZXl9KTtcblx0XHR9O1xuICAgIH1cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHAudXNlcnNcIilcblxuICAgICAgICAuc2VydmljZShcInVzZXJzU2VydmljZVwiLCB1c2Vyc1NlcnZpY2UpO1xuXG5cbiAgICBmdW5jdGlvbiB1c2Vyc1NlcnZpY2UoJHEsIGF1dGhTZXJ2aWNlKSB7XG5cdCAgICByZXR1cm4ge1xuICAgICAgICAgICAgdXBkYXRlUHJvZmlsZTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS51c2VyKCkudXBkYXRlUHJvZmlsZShkYXRhKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShcIlByb2ZpbGUgdXBkYXRlZCFcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCduYW1lLWNoYW5nZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3IoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcblxuICAgICAgICAubW9kdWxlKCdhcHAnLCBbXG4gICAgICAgICAgICAnaW9uaWMnLFxuXHRcdFx0XG5cdFx0XHQnYXBwLmZpcmViYXNlJyxcbiAgICAgICAgICAgICdhcHAuYXV0aCcsXG4gICAgICAgICAgICAnYXBwLm1lc3NhZ2UnLFxuXHRcdFx0J2FwcC5zaWRlbWVudScsXG4gICAgICAgICAgICAnYXBwLmJ1aWxkaW5ncycsXG4gICAgICAgICAgICAnYXBwLnByb2ZpbGVzJ1xuICAgICAgICBdKVxuXHRcdFxuXHRcdC52YWx1ZShcInVzZXJcIiwgbnVsbClcblx0XHQudmFsdWUoXCJzZWxlY3RlZEJ1aWxkaW5nXCIsIG51bGwpXG5cbiAgICAgICAgLnJ1bihmdW5jdGlvbiAoJGlvbmljUGxhdGZvcm0sICR0aW1lb3V0LCAkcm9vdFNjb3BlKSB7XG5cdFx0XHQkaW9uaWNQbGF0Zm9ybS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5jb3Jkb3ZhICYmIHdpbmRvdy5jb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29yZG92YS5wbHVnaW5zLktleWJvYXJkLmhpZGVLZXlib2FyZEFjY2Vzc29yeUJhcih0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICBjb3Jkb3ZhLnBsdWdpbnMuS2V5Ym9hcmQuZGlzYWJsZVNjcm9sbCh0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5TdGF0dXNCYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgU3RhdHVzQmFyLnN0eWxlRGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIH1cblx0XHRcdFx0XG5cdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdCgnbmFtZS1jaGFuZ2VkJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG59KSgpO1xuXG5cbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuXG4gICAgICAgIC5tb2R1bGUoJ2FwcCcpXG5cbiAgICAgICAgLnJ1bihbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzdGF0ZSwgYXV0aFNlcnZpY2UpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLnVzZXIoKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnbG9naW4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG5cbiAgICAgICAgLm1vZHVsZSgnYXBwJylcblx0XHRcbiAgICAgICAgLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gICAgICAgICAgICAkc3RhdGVQcm92aWRlclxuXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdhcHAnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9hcHAnLFxuXHRcdFx0XHRcdGNhY2hlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3Mvc2lkZW1lbnUuaHRtbCcsXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLmJ1aWxkaW5ncycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2J1aWxkaW5ncycsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9idWlsZGluZ3MuaHRtbCdcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAuc3RhdGUoJ2FwcC5idWlsZGluZycsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2J1aWxkaW5ncy86YnVpbGRpbmdJZCcsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9idWlsZGluZy5odG1sJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIC5zdGF0ZSgnYXBwLnByb2ZpbGUnLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJy9wcm9maWxlJyxcblx0XHRcdFx0XHRjYWNoZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbWVudUNvbnRlbnQnOiB7XG5cdFx0XHRcdFx0XHRcdHRlbXBsYXRlVXJsOiAndmlld3MvcHJvZmlsZS9wcm9maWxlLmh0bWwnXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuXG5cdFx0XHRcdC5zdGF0ZSgnYXBwLmxvZ291dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9sb2dpblwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVByb3ZpZGVyOiBmdW5jdGlvbiAoYXV0aFNlcnZpY2UsICRzdGF0ZSkge1xuXHRcdFx0XHRcdFx0YXV0aFNlcnZpY2UubG9nb3V0KCk7XG5cdFx0XHRcdFx0XHQkc3RhdGUuZ28oJ2xvZ2luJyk7XG5cdFx0XHRcdFx0fVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXRlKCdsb2dpbicsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9sb2dpblwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJ2aWV3cy9hdXRoL2xvZ2luLmh0bWxcIlxuICAgICAgICAgICAgICAgIH0pO1xuXHRcdFx0XHRcblxuICAgICAgICAgICAgLy9mYWxsYmFja1xuICAgICAgICAgICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnL2xvZ2luJyk7XG5cbiAgICAgICAgfSk7XG59KSgpO1xuXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
